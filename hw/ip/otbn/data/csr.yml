# Copyright lowRISC contributors (OpenTitan project).
# Licensed under the Apache License, Version 2.0, see LICENSE for details.
# SPDX-License-Identifier: Apache-2.0

- name: fg0
  address: 0x7c0
  doc: |
    Wide arithmetic flag group 0.
    This CSR provides access to flag group 0 used by wide integer arithmetic.
    *FLAGS*, *FG0* and *FG1* provide different views on the same underlying bits.
  bits:
    0: Carry of flag group 0
    1: MSb of flag group 0
    2: LSb of flag group 0
    3: Zero of flag group 0
    31-4: Reserved. Always reads as 0. Any write is ignored.

- name: fg1
  address: 0x7c1
  doc: |
    Wide arithmetic flag group 1.
    This CSR provides access to flag group 1 used by wide integer arithmetic.
    *FLAGS*, *FG0* and *FG1* provide different views on the same underlying bits.
  bits:
    0: Carry of flag group 1
    1: MSb of flag group 1
    2: LSb of flag group 1
    3: Zero of flag group 1
    31-4: Reserved. Always reads as 0. Any write is ignored.

- name: flags
  address: 0x7c8
  doc: |
    Wide arithmetic flag groups.
    This CSR provides access to both flag groups used by wide integer arithmetic.
    *FLAGS*, *FG0* and *FG1* provide different views on the same underlying bits.
  bits:
    0: Carry of flag group 0
    1: MSb of flag group 0
    2: LSb of flag group 0
    3: Zero of flag group 0
    4: Carry of flag group 1
    5: MSb of flag group 1
    6: LSb of flag group 1
    7: Zero of flag group 1
    31-8: Reserved. Always reads as 0. Any write is ignored.

- name: mod0
  address: 0x7d0
  doc: |
    Bits [31:0] of the modulus operand, used in the {{#otbn-insn-ref BN.ADDM}}/{{#otbn-insn-ref BN.SUBM}} instructions.
    This CSR is mapped to the MOD WSR.

- name: mod1
  address: 0x7d1
  doc: |
    Bits [63:32] of the modulus operand, used in the {{#otbn-insn-ref BN.ADDM}}/{{#otbn-insn-ref BN.SUBM}} instructions.
    This CSR is mapped to the MOD WSR.

- name: mod2
  address: 0x7d2
  doc: |
    Bits [95:64] of the modulus operand, used in the {{#otbn-insn-ref BN.ADDM}}/{{#otbn-insn-ref BN.SUBM}} instructions.
    This CSR is mapped to the MOD WSR.

- name: mod3
  address: 0x7d3
  doc: |
    Bits [127:96] of the modulus operand, used in the {{#otbn-insn-ref BN.ADDM}}/{{#otbn-insn-ref BN.SUBM}} instructions.
    This CSR is mapped to the MOD WSR.

- name: mod4
  address: 0x7d4
  doc: |
    Bits [159:128] of the modulus operand, used in the {{#otbn-insn-ref BN.ADDM}}/{{#otbn-insn-ref BN.SUBM}} instructions.
    This CSR is mapped to the MOD WSR.

- name: mod5
  address: 0x7d5
  doc: |
    Bits [191:160] of the modulus operand, used in the {{#otbn-insn-ref BN.ADDM}}/{{#otbn-insn-ref BN.SUBM}} instructions.
    This CSR is mapped to the MOD WSR.

- name: mod6
  address: 0x7d6
  doc: |
    Bits [223:192] of the modulus operand, used in the {{#otbn-insn-ref BN.ADDM}}/{{#otbn-insn-ref BN.SUBM}} instructions.
    This CSR is mapped to the MOD WSR.

- name: mod7
  address: 0x7d7
  doc: |
    Bits [255:224] of the modulus operand, used in the {{#otbn-insn-ref BN.ADDM}}/{{#otbn-insn-ref BN.SUBM}} instructions.
    This CSR is mapped to the MOD WSR.

- name: rnd_prefetch
  address: 0x7d8
  doc: |
    Write to this CSR to begin a request to fill the RND cache.
    Always reads as 0.

- name: kmac_if_status
  address: 0x7d9
  doc: |
    Write a 1 to bits 1 or 2 to clear the error bits.
    KMAC_IF_STATUS is a CSR that exposes status information for the OTBN-KMAC interface.
  bits:
    0: MSG_WRITE_RDY indicates whether the KMAC_DATA_S0/1 WSR is ready for the next word.
    1: MSG_SEND_ERROR (W1C) indicates whether an error occurred after issuing a message send command.
    2: MSG_WRITE_ERROR (W1C) indicates whether an error occurred after writing to the KMAC_DATA_S0/1 WSR.
    3: DIGEST_VALID indicates whether the 64 bit word in KMAC_DATA_S0/1 WSR is valid.
    31-4: Reserved. Always reads as 0. Any write is ignored.

- name: kmac_intr
  address: 0x7da
  doc: |
    KMAC_INTR is a CSR that exposes the KMAC_ERROR interrupt of the KMAC HWIP.
  bits:
    0: KMAC_ERROR (W1C) indicates whether an error occurred in the KMAC HWIP.
    31-1: Reserved. Always reads as 0. Any write is ignored.

- name: kmac_cfg
  address: 0x7db
  doc: |
    A configuration register for the KMAC interface.
    The encodings for the fields are equivalent to the encodings for the CFG_SHADOWED register in the KMAC HWIP.
  bits:
    0: KMAC_EN enables keyed operation in the KMAC HWIP (kmac_en = 0/1).
    3-1: STRENGTH allows OTBN to select the desired security strength (kstrength = L128 / L224 / L256 / L384 / L512).
    5-4: MODE allows OTBN to set the KMAC hashing mode (mode = SHAKE / cSHAKE / SHA3).
    31-6: Reserved. Always reads as 0. Any write is ignored.

- name: kmac_msg_send
  address: 0x7dc
  doc: |
    A command register to send a message to KMAC.
    Reads from this register always return a 0.
  bits:
    0: MSG_SEND can be set to send the contents of KMAC_DATA_S0 and KMAC_DATA_S1 to KMAC.
    31-1: Reserved. Always reads as 0. Any write is ignored.

- name: kmac_cmd
  address: 0x7dd
  doc: |
    The encodings for the commands are equivalent to the encodings for the CMD register in the KMAC HWIP.
    Reads from this register always return a 0.
  bits:
    5-0: CMD is the KMAC command field used to issue START, PROCESS, RUN and DONE commands to KMAC.
    31-6: Reserved. Always reads as 0. Any write is ignored.

- name: kmac_byte_strobe
  address: 0x7de
  doc: |
    The input bytes of KMAC_DATA_S0/1 that are valid and should be consumed by KMAC.

    For all message chunks except the final one, BYTE_STROBE must be programmed to all ones, indicating that all bytes in KMAC_DATA are valid. For the final message chunk, selected bits may be cleared to indicate unused bytes.
    Any cleared bits must correspond to the most-significant bytes only, that is, the mask must be contiguous, with no zero bit followed by a one at a higher significance.
    This needs to be the case, because that's how SHA3 inside KMAC expects the data.
    If a non contiguous strobe is defined the behaviour is undefined.

    Reads from this register return the current configuration of the KMAC_BYTE_STROBE CSR.
  bits:
    31-0: BYTE_STROBE is the KMAC byte strobe field.

- name: mai_ctrl
  address: 0x7f0
  doc: |
    The MAI control register. This is used to start MAI operations as well as configuring the accelerators.
  bits:
    0: |
      MAI_START: Writing 1 to this bit starts the MAI operation.
      Writing it when MAI is busy will cause a MAI_ERROR software error.
    2-1:
      doc: |
        The MAI_OPERATION field defines which accelerator is used for the next operation.
        Invalid values and writing to these bits when MAI is busy will cause a MAI_ERROR software error.
      values:
        0: A2B
        1: B2A
        2: secAdd
    31-3: Reserved. Any write is ignored. Always reads as 0.

- name: rnd
  address: 0xfc0
  read-only: true
  doc: |
    An AIS31-compliant class PTG.3 random number with guaranteed entropy and forward and backward secrecy.
    Primarily intended to be used for key generation.

    The number is sourced from the EDN via a single-entry cache.
    Reads when the cache is empty will cause OTBN to be stalled until a new random number is fetched from the EDN.

- name: urnd
  address: 0xfc1
  read-only: true
  doc: |
    A random number without guaranteed secrecy properties or specific statistical properties.
    Intended for use in masking and blinding schemes.
    Use RND for high-quality randomness.

    The number is sourced from an local PRNG.
    Reads never stall.

- name: kmac_status
  address: 0xfc2
  read-only: true
  doc: |
    Writes to this CSR are always ignored.
    This CSR exposes the internal state of the SHA3 FSM within KMAC.
  bits:
    0: SHA3_IDLE indicates whether the SHA3 core is in the idle state.
    1: SHA3_ABSORB indicates whether the SHA3 core is in the absorb state.
    2: SHA3_SQUEEZE indicates whether the SHA3 core is in the squeeze state.
    31-3: Reserved. Always reads as 0. Any write is ignored.

- name: kmac_error
  address: 0xfc3
  read-only: true
  doc: |
    Writes to this register are ignored.
    This register exposes the error code from the KMAC HWIP ERR_CODE register.
    No other information from the KMAC HWIP ERR_CODE register is exposed.
  bits:
    7-0: ERROR_CODE contains the error code coming directly from the KMAC HWIP.
    31-8: Reserved. Always reads as 0. Any write is ignored.

- name: mai_status
  address: 0xfe0
  read-only: true
  doc: |
    The MAI status register.
  bits:
    0: |
      MAI_BUSY: This bit is set to 1 when an MAI operation is in progress.
      If reset, the MAI accepts new configuration values and a new execution can be started by writing to the MAI_START bit in the MAI_CTRL CSR.
    1: |
      MAI_READY: This bit is set to 1 when the MAI_INx_Sx WSRs are ready to accept new values for the next execution.
    31-2: Reserved. Always reads as 0.
