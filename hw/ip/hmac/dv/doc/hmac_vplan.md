
| Depth | Name | Reference | Coverage\_Result | Description | Metric\_Type | Item | Owner | Priority | Milestone | Weight | Goal | Issue | Comment | Tag |
| :---: | :---- | ----- | ----- | :---- | :---: | :---- | ----- | ----- | ----- | ----- | ----- | ----- | :---- | ----- |
| 0 | hmac |  |  |  | dut\_name |  |  |  |  |  |  |  |  |  |
| 1 | technical\_specification |  |  | [https://opentitan.org/book/hw/ip/hmac/index.html](https://opentitan.org/book/hw/ip/hmac/index.html) | section\_title |  |  |  |  |  |  |  |  |  |
| 2 | overview |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | comportability | req\_hmac\_0001 |  | This module conforms to the comportability doc/contributing/hw/comportability/README.md | inspection |  | Martin |  |  |  |  |  |  |  |
| 3 | features |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | mode\_sha2\_hmac | req\_hmac\_0002 |  | Two modes: SHA-2 | HMAC based on SHA-2 | functional | rd\_digest\_during\_hmac\_en\_cg | Martin |  |  |  |  |  |  |  |
| 4 | digest\_size | req\_hmac\_0003 |  | Multiple digest sizes supported (for both modes): SHA-2 256/384/512 hashing algorithm | functional | cfg\_cg.digest\_size | Martin |  |  |  |  |  |  |  |
| 4 | key\_length | req\_hmac\_0004 |  | Configurable key length 128/256/384/512/1024-bit secret key for HMAC mode | functional | cfg\_cg.key\_length | Martin |  |  |  |  |  |  |  |
| 4 | context\_switching | req\_hmac\_0005 |  | Support for context switching (via saving and restoring) across multiple message streams | functional | save\_and\_restore\_cg | Martin |  |  |  |  |  |  |  |
| 4 | message\_fifo\_size | req\_hmac\_0006 |  | 32 x 32-bit message FIFO buffer | formal | TODO | Martin |  |  |  |  |  |  |  |
| 3 | description |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | sha2\_spec | req\_hmac\_0007 |  | The HMAC module is a SHA-2 hash-based (see: NIST) | testcase, testcase | hmac\_test\_vectors\_sha, hmac\_test\_vectors\_hmac | Martin |  |  |  |  |  | Test against NIST vectors |  |
| 4 | sha2\_256 | req\_hmac\_0003 |  | It supports SHA-2 256/384/512 | functional | cfg\_cg.digest\_size.sha2\_256 | Martin |  |  |  |  |  |  |  |
| 4 | sha2\_384 | req\_hmac\_0003 |  | It supports SHA-2 256/384/512 | functional | cfg\_cg.digest\_size.sha2\_384 | Somebody else |  |  |  |  |  |  |  |
| 4 | sha2\_512 | req\_hmac\_0003 |  | It supports SHA-2 256/384/512 | functional | cfg\_cg.digest\_size.sha2\_512 | Martin |  |  |  |  |  |  |  |
| 4 | key\_128 | req\_hmac\_0004 |  | It supports 128/256/512/1024-bit keys in HMAC mode | functional | cfg\_cg.key\_length.key\_128 | Martin |  |  |  |  |  |  |  |
| 4 | key\_256 | req\_hmac\_0004 |  | It supports 128/256/512/1024-bit keys in HMAC mode | functional | cfg\_cg.key\_length.key\_256 | Martin |  |  |  |  |  |  |  |
| 4 | key\_512 | req\_hmac\_0004 |  | It supports 128/256/512/1024-bit keys in HMAC mode | functional | cfg\_cg.key\_length.key\_512 | Martin |  |  |  |  |  |  |  |
| 4 | key\_2024 | req\_hmac\_0004 |  | It supports 128/256/512/1024-bit keys in HMAC mode | functional | cfg\_cg.key\_length.key\_1024 | Martin |  |  |  |  |  |  |  |
| 4 | sha2\_x\_keys | req\_hmac\_0003, req\_hmac\_0004, req\_hmac\_0014 |  | Test all SHA2 with all the key length that does not exceed the block size of the configured SHA-2 digest size | functional | cfg\_cg.key\_length\_x\_digest\_size | Martin |  |  |  |  |  |  |  |
| 4 | hmac\_done\_irq | req\_hmac\_0008 |  | The \`hmac\_done\` interrupt is raised to report to software that the final digest is available. | assertion, assertion | TODO, TODO | Martin |  |  |  |  |  | One assertion can be added to the RTL and another one to the SB when hmac\_done read is detected |  |
| 4 | sha2\_only | req\_hmac\_0002 |  | The HMAC IP can run in SHA-2 only mode, whose purpose is to check the correctness of the received message. The same digest registers above are used to hold the final hash result. SHA-2 mode does not use the given secret key. It generates the same result with the same message every time. | functional, functional | cfg\_cg.hmac\_dis\_x\_sha\_en, wr\_key\_during\_sha\_only\_cg | Martin |  |  |  |  |  |  |  |
| 4 | auto\_msg\_length | req\_hmac\_0009 |  | The HMAC IP will calculate the length of the message received between 1 being written to CMD.hash\_start and 1 being written to CMD.hash\_process. | functional, functional | msg\_len\_cg.msg\_len\_lower\_cross, msg\_len\_cg.msg\_len\_upper\_cross | Martin |  |  |  |  |  |  |  |
| 4 | wipe\_secret | req\_hmac\_000A |  | Is able to wipe internal variables such as the secret key, intermediate hash results, digest and the internal message scheduling array. The software can wipe the secret key by writing a 32-bit random value into WIPE\_SECRET register. The internal variables and secret key will be reset to the written value. | testcase, assertion, assertion, assertion, assertion | hmac\_wipe\_secret, WipeSecretKeyAssert, WipeHashAssert, WipeMsgSchArrAssert, WipeDigestAssert | Martin |  |  |  |  |  | See if required: WipeWordBufferAssert, WipeFullWordAssert |  |
| 4 | wipe\_sha2\_384\_512\_modes | req\_hmac\_000B |  | For SHA-2 384/512 modes that operate on 64-bit words, the 32-bit random value is replicated and concatenated to create the 64-bit value. | testcase, assertion | hmac\_wipe\_secret, wipe\_secret\_64bits\_a | Martin |  |  |  |  |  |  |  |
| 1 | theory\_of\_operation |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/theory\_of\_operation.html](https://opentitan.org/book/hw/ip/hmac/doc/theory_of_operation.html) | section\_title |  |  |  |  |  |  |  |  |  |
| 2 | block\_diagram |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/theory\_of\_operation.html\#block-diagram](https://opentitan.org/book/hw/ip/hmac/doc/theory_of_operation.html#block-diagram) | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | sha2\_hash\_engine | imp\_hmac\_0001 |  | The SHA-2 hash engine is a SHA-2 engine primitive instantiated with the multi-mode feature enabled | formal | TODO | Martin |  |  |  |  |  | Check the parameter value |  |
| 3 | sha2\_core\_fifo\_size | imp\_hmac\_0002 |  | SHA-2 block contains two time a 8x64-bit size FIFOs (one for the hash and one for the digest) | formal | TODO | Martin |  |  |  |  |  | Check that the 2 FIFOs exist and are the right size |  |
| 3 | sha2\_msg\_scheduling\_fifo | imp\_hmac\_0003 |  | The message scheduling FIFO is not software accessible but is fed from the 32x32b message FIFO seen in the HMAC block diagram via the HMAC core. | formal | TODO | Martin |  |  |  |  |  | Check that the FIFO exists and is the right size |  |
| 3 | sha2\_msg\_padding | req\_hmac\_000C |  | The message words are padded with the message length appended to fit either the 512-bit or 1024-bit block size (depending on the configured digest size) | functional | msg\_len\_cg.msg\_len\_lower\_cp | Martin |  |  |  |  |  |  |  |
| 3 | blk\_512\_rounds | req\_hmac\_000D |  | With the 512-bit block (for SHA-2 256), the compression function runs 64 rounds to calculate the block hash, which is stored in the hash registers above. | functional | cfg\_cg.digest\_size.sha2\_256 | Martin |  |  |  |  |  | Covered by the C model as the returned digest is matching |  |
| 3 | blk\_512\_digest | req\_hmac\_000D |  | After 64 rounds are completed, the SHA-2 256 updates the digest registers with the addition of the hash result and the previous digest registers. | functional | cfg\_cg.digest\_size.sha2\_256 | Martin |  |  |  |  |  | Covered by the C model as the returned digest is matching |  |
| 3 | blk\_1024\_rounds | req\_hmac\_000E |  | With the 1024-bit block (for SHA-2 384/512), the compression function runs 80 rounds instead. | functional, functional | cfg\_cg.digest\_size.sha2\_384, cfg\_cg.digest\_size.sha2\_512 | Martin |  |  |  |  |  | Covered by the C model as the returned digest is matching |  |
| 3 | blk\_1024\_digest | req\_hmac\_000E |  | SHA-2 384 is a truncated version of SHA-2 512 where the last 128 bits of the final digest output are truncated to reduce the digest size to 384 bits. | functional | cfg\_cg.digest\_size.sha2\_384 | Martin |  |  |  |  |  | Covered by the C model as the returned digest is matching |  |
| 2 | design\_details |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/theory\_of\_operation.html\#design-details](https://opentitan.org/book/hw/ip/hmac/doc/theory_of_operation.html#design-details) | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | sha2\_message\_feed\_and\_pad |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/theory\_of\_operation.html\#sha-2-message-feed-and-pad](https://opentitan.org/book/hw/ip/hmac/doc/theory_of_operation.html#sha-2-message-feed-and-pad) | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | wr\_msg\_fifo | imp\_hmac\_0004 |  | Any write access to the memory-mapped window MSG\_FIFO updates the message FIFO. | formal | TODO | Martin |  |  |  |  |  |  |  |
| 4 | fifo\_full\_back\_pressure | req\_hmac\_0018 |  | If the FIFO is full, the HMAC block will block any writes leading to back-pressure on the interconnect | functional | TODO | Martin |  |  |  |  |  | Do writes while the FIFO is full |  |
| 4 | fifo\_full\_status | imp\_hmac\_0006 |  | The FIFO full is available in STATUS register | formal | TODO | Martin |  |  |  |  |  |  |  |
| 4 | endian\_swap | req\_hmac\_002D |  | When CFG.endian\_swap=1, input message is converted from little-endian to big-endian before feeding it to the SHA-2 | functional | cfg\_cg.endian\_swap | Martin |  |  |  |  |  |  |  |
| 4 | digest\_swap | req\_hmac\_002C |  | When CFG.digest\_swap=1, each digest output register is converted to big-endian byte order | functional | cfg\_cg.digest\_swap | Martin |  |  |  |  |  |  |  |
| 4 | 32bits\_words | imp\_hmac\_0009 |  | Small writes to MSG\_FIFO are coalesced into 32-bit words by the packer logic | functional | TODO | Martin |  |  |  |  |  | Be sure that small writes have been exercised by adding a fcov |  |
| 4 | msg\_length | req\_hmac\_0009 |  | The block also counts the number of bytes that are being passed. This computes the received message length. | functional, functional | msg\_len\_cg.msg\_len\_lower\_cp, msg\_len\_cg.msg\_len\_upper\_cp | Martin |  |  |  |  |  |  |  |
| 4 | msg\_structure | req\_hmac\_000C |  | The message must be padded to fill the 512/1024-bit blocks. This is done with an initial \*\*1\*\* bit after the actual message bits, followed by enough \*\*0\*\* padding bits, and then the 64/128-bit message length at the end of the block. The number of \*\*0\*\* padding bits should be enough such that the full block size (512 or 1024 bits) is achieved. | functional | msg\_len\_cg.msg\_len\_lower\_cp | Martin |  |  |  |  |  | Covered by the C model |  |
| 3 | sha2\_computation |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/theory\_of\_operation.html\#sha-2-computation](https://opentitan.org/book/hw/ip/hmac/doc/theory_of_operation.html#sha-2-computation) | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | blk\_512\_word\_pad | req\_hmac\_000D |  | For SHA-2 256, the SHA-2 engine receives 16x32-bit words from the message FIFO or the HMAC core, which get padded into 16x64-bit words for the SHA-2 engine (upper 32 bits of each data word are all-zero padded) | functional | cfg\_cg.digest\_size.sha2\_256 | Martin |  |  |  |  |  | Covered by the C model |  |
| 4 | blk\_512\_rounds | req\_hmac\_000D |  | And then begin 64 rounds of the hash computation. | functional | TODO | Martin |  |  |  |  |  | Add a check in the SB where this param is used HMAC\_MSG\_PROCESS\_CYCLES\_256 |  |
| 4 | blk\_1024\_word\_pack | req\_hmac\_000E |  | Alternatively for SHA-2 384/512, the SHA-2 engine receives 32x32-bit words from message FIFO, which get packed into 16x64-bit words for the SHA-2 engine | functional, functional | cfg\_cg.digest\_size.sha2\_384, cfg\_cg.digest\_size.sha2\_512 | Martin |  |  |  |  |  | Covered by the C model |  |
| 4 | blk\_1024\_rounds | req\_hmac\_000E |  | And then begin the 80 compression rounds. | functional | TODO | Martin |  |  |  |  |  | Add a check in the SB where this param is used HMAC\_MSG\_PROCESS\_CYCLES\_512 |  |
| 4 | sw\_access\_msg\_fifo | req\_hmac\_000F |  | During the compression rounds, it doesn't fetch data from the message FIFO. The software can push up to 16 (or 32 for SHA-2 384/512) entries to the FIFO for the next hash computation. | functional | wr\_msg\_during\_hash\_cg | Martin |  |  |  |  |  |  |  |
| 3 | hmac\_computation |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/theory\_of\_operation.html\#hmac-computation](https://opentitan.org/book/hw/ip/hmac/doc/theory_of_operation.html#hmac-computation) | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | hmac\_first\_round | req\_hmac\_0010 |  | The first phase of HMAC calculates the SHA-2 hash of the inner secret key concatenated with the actual message to be authenticated. | functional | cfg\_cg.hmac\_en.enabled | Martin |  |  |  |  |  | Covered by the C model |  |
| 4 | inner\_secret\_key | req\_hmac\_0011 |  | This inner secret key is created with the 128/256/384/512/1024-bit (hashed) secret key (depending on the configured key length) and \`0x00\` padding to complete the corresponding block size of the configured digest size. This is XORed with 64 bits 0x36 value. | functional | cfg\_cg.hmac\_en\_x\_key\_length | Martin |  |  |  |  |  | Covered by the C model |  |
| 4 | hmac\_second\_round | req\_hmac\_0012 |  | The first round digest is fed into the second round in HMAC. The second round computes the hash of the outer secret key concatenated with the first round digest. | functional | cfg\_cg.hmac\_en.enabled | Martin |  |  |  |  |  | Covered by the C model |  |
| 4 | outer\_secret\_key | req\_hmac\_0013 |  | This outer secret key is created with the 128/256/384/512/1024-bit (hashed) secret key (depending on the configured key length) and \`0x00\` padding to complete the corresponding block size of the configured digest size. This is XORed with 64 bits 0x5c value. | functional | cfg\_cg.hmac\_en\_x\_key\_length | Martin |  |  |  |  |  | Covered by the C model |  |
| 4 | max\_key\_length | req\_hmac\_0014 |  | HMAC supports a secret key of length 128/256/384/512/1024-bit, so long as the key length does not exceed the block size of the configured digest. | functional | err\_code\_cg.key\_length\_higher\_blk\_size | Martin |  |  |  |  |  |  |  |
| 4 | key\_endianness | req\_hmac\_002D |  | The byte order of the key registers is big-endian by default, can be swapped to little endian by setting \[\`CFG.key\_swap\`\](registers.md\#cfg--key\_swap) to 1\. | functional | cfg\_cg.endian\_swap | Martin |  |  |  |  |  |  |  |
| 4 | arbitrary\_key\_length | req\_hmac\_0016 |  | To support any arbitrary key length, the software should configure the HMAC to the next largest supported key length | functional | TODO | Martin |  |  |  |  |  | MVy: it hasn't been verified yet \! (13.11.2024) |  |
| 3 | perf\_sha2\_hmac\_modes |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/theory\_of\_operation.html\#performance-in-sha-2-mode-and-hmac-mode](https://opentitan.org/book/hw/ip/hmac/doc/theory_of_operation.html#performance-in-sha-2-mode-and-hmac-mode) | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | wr\_msg\_fifo\_during\_hash | req\_hmac\_0017 |  | The software can feed the next 16 x 32-bit message block during the 48 rounds required by the SHA block to compute the HASH of current message block. | functional | wr\_msg\_during\_hash\_cg | Martin |  |  |  |  |  |  |  |
| 4 | fifo\_full\_access\_blocked | req\_hmac\_0018 |  | Once the FIFO gets full, the software cannot push more data until the current block is processed. | functional | TODO | Martin |  |  |  |  |  | Do writes while the FIFO is full |  |
| 4 | sha2\_256\_performance | imp\_hmac\_000B |  | This version of the IP fetches the next 16 x 32-bit message into the internal message scheduling array only after completing the current block. As such, it takes 80 cycles to complete a block. | formal | TODO | Martin |  |  |  |  |  |  |  |
| 4 | sha2\_384\_512\_performance | imp\_hmac\_000C |  | For SHA-2 384/512, the algorithm computes 1024 bits of data a time and runs for 80 rounds where the first 16 rounds consume the actual 16 x 64-bit message. It takes 96 cycles to complete a 1024-bit block. | formal | TODO | Martin |  |  |  |  |  |  |  |
| 4 | hmac\_overhead\_performance | imp\_hmac\_000D |  | If HMAC mode is turned on, it introduces extra latency due to the second round of computing the final hash of the outer key and the result of the first round using the inner key. This adds an extra 240 cycles (80 for the inner key, 80 for the outer key, and 80 for the result of the first round) to complete a HMAC SHA-2 256 digest of a message. | formal | TODO | Martin |  |  |  |  |  |  |  |
| 3 | msg\_fifo |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/theory\_of\_operation.html\#msg\_fifo](https://opentitan.org/book/hw/ip/hmac/doc/theory_of_operation.html#msg_fifo) | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | msg\_fifo\_wr | imp\_hmac\_000E |  | Any writes to the address range go into the single entry point of the \`prim\_packer\`. Then \`prim\_packer\` compacts the data into the word-size if not a word-write then writes to the MSG\_FIFO. | functional | TODO | Martin |  |  |  |  |  | Be sure that writting anywhere in the address range has the same impact and for any word size |  |
| 1 | interfaces |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/interfaces.html](https://opentitan.org/book/hw/ip/hmac/doc/interfaces.html) | section\_title |  |  |  |  |  |  |  |  |  |
| 2 | clock\_in | req\_hmac\_0025 |  | TODO: do we have a clock spec somewhere? We should use a clock agent which is able to emulate the defects that a "real world" clock may have. | functional | TODO | Martin |  |  |  |  |  | Get cov from the agent |  |
| 2 | reset |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | reset\_in | req\_hmac\_0026 |  | TODO: test random resets via an agent | functional | TODO | Martin |  |  |  |  |  | Get cov from the agent |  |
| 3 | reset\_during\_hash |  |  |  | functional | trig\_rst\_during\_hash\_cg | Martin |  |  |  |  |  |  |  |
| 2 | tile\_link |  |  |  | functional | TODO | Martin |  |  |  |  |  | Get cov from the agent |  |
| 2 | inter\_module\_signals |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | idle | req\_hmac\_0022 |  | Idle should be high when TODO see [https://github.com/lowRISC/opentitan/blob/4ec9f5238bf0f21a03164819d8c637a19e30d759/hw/ip/hmac/rtl/hmac.sv\#L867](https://github.com/lowRISC/opentitan/blob/4ec9f5238bf0f21a03164819d8c637a19e30d759/hw/ip/hmac/rtl/hmac.sv#L867) | formal, functional | TODO, TODO | Martin |  |  |  |  |  |  |  |
| 3 | tl\_rsp |  |  | TODO: how and what should be checked ? | functional | TODO | Martin |  |  |  |  |  |  |  |
| 2 | interrupts |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/interfaces.html\#interrupts](https://opentitan.org/book/hw/ip/hmac/doc/interfaces.html#interrupts) | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | hmac\_done | req\_hmac\_0008 |  | An event should be raised when HMAC/SHA-2 has completed. | assertion, assertion | TODO, TODO | Martin |  |  |  |  |  | One assertion can be added to the RTL and another one to the SB when hmac\_done read is detected |  |
| 3 | fifo\_empty | req\_hmac\_001A |  | The HW should indicate the message FIFO empty status on this interrupt line (see corresponding register for details). | functional, functional | cip\_base\_pkg::intr\_cg.cp\_intr, TODO | Martin |  |  |  |  |  | Implement a cov to be triggered from the SB when these conditions have been detected |  |
| 3 | hmac\_err | req\_hmac\_0019 |  | An event should be raised when an HMAC error has occured. | functional | TODO | Martin |  |  |  |  |  | Not sure it is modelled correctly and add a cov |  |
| 2 | security\_alerts |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/interfaces.html\#security-alerts](https://opentitan.org/book/hw/ip/hmac/doc/interfaces.html#security-alerts) | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | fatal\_fault | req\_hmac\_0023 |  | This fatal alert should be triggered when a fatal TL-UL bus integrity fault is detected. | functional | TODO | Martin |  |  |  |  |  |  |  |
| 2 | security\_countermeasures |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/interfaces.html\#security-countermeasures](https://opentitan.org/book/hw/ip/hmac/doc/interfaces.html#security-countermeasures) | section\_title |  |  |  |  |  |  |  | [https://opentitan.org/book/doc/contributing/hw/comportability/index.html\#security-countermeasures](https://opentitan.org/book/doc/contributing/hw/comportability/index.html#security-countermeasures) |  |
| 3 | bus\_integrity | req\_hmac\_0024 |  | End-to-end bus integrity scheme. | functional | TODO | Martin |  |  |  |  |  |  |  |
| 1 | registers |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/registers.html](https://opentitan.org/book/hw/ip/hmac/doc/registers.html) | section\_title |  |  |  |  |  |  |  |  |  |
| 2 | general\_csr\_tests |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | csr\_hw\_reset |  |  | CSRs should be compliant with the reset value provided in the RAL specification. | testcase | csr\_hw\_reset | Martin |  |  |  |  |  |  |  |
| 3 | csr\_read\_write |  |  | CSRs should be R/W accessible according to their specified access policies. | testcase | csr\_rw | Martin |  |  |  |  |  |  |  |
| 3 | csr\_bit\_bash |  |  | There should be no aliasing within the fields / bits of a CSR. | testcase | csr\_bit\_bash | Martin |  |  |  |  |  |  |  |
| 3 | csr\_aliasing |  |  | There should be no aliasing across the address bits within the valid CSR space. | testcase | csr\_aliasing | Martin |  |  |  |  |  |  |  |
| 2 | intr\_state |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | hmac\_err | req\_hmac\_0019 |  | When an error occured on the HMAC hmac\_err bit should be raised. | functional | TODO | Martin |  |  |  |  |  | Not sure it is modelled correctly and add a cov |  |
| 3 | fifo\_empty | req\_hmac\_001A |  | This interrupt is raised only if the message FIFO is actually writable by software, i.e., if all of the following conditions are met: i) The HMAC block is not running in HMAC mode and performing the second round of computing the final hash of the outer key as well as the result of the first round using the inner key. ii) Software has not yet written the Process or Stop command to finish the hashing operation. For the interrupt to be raised, the message FIFO must also have been full previously. | functional, functional | cip\_base\_pkg::intr\_cg.cp\_intr, TODO | Martin |  |  |  |  |  | Implement a cov to be triggered from the SB when these conditions have been detected |  |
| 3 | hmac\_done | req\_hmac\_0008 |  | The hmac\_done bit is raised when HMAC/SHA-2 has completed. | assertion, assertion | TODO, TODO | Martin |  |  |  |  |  | One assertion can be added to the RTL and another one to the SB when hmac\_done read is detected |  |
| 2 | intr\_enable |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | intr\_enable | req\_hmac\_001C |  | Physical output interrupts should follow the intr\_state register when the corresponding bits are enabled in intr\_enable register. | functional | TODO | Martin |  |  |  |  |  |  |  |
| 2 | intr\_test |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | intr\_test | req\_hmac\_001D |  | In order to test interrupts at physical output level and at register level, a register should be provided to force each field individually. | functional, functional | TODO, cip\_base\_pkg::intr\_test\_cg | Martin |  |  |  |  |  |  |  |
| 2 | alert\_test |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | alert\_test | req\_hmac\_001E |  | In order to test alerts, a register should be provided to force each field individually. | functional | TODO | Martin |  |  |  |  |  |  |  |
| 2 | cfg |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/registers.html\#cfg](https://opentitan.org/book/hw/ip/hmac/doc/registers.html#cfg) | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | cfg\_update | req\_hmac\_0038 |  | The register is updated when the engine is in Idle. If the software updates the register while the engine computes the hash, the updated value is discarded. | functional | wr\_config\_during\_hash\_cg | Martin |  |  |  |  |  |  |  |
| 3 | cfg\_cross |  |  | All the configuration combinations should be supported | functional | cfg\_cg.cfg\_cross |  |  |  |  |  |  |  |  |
| 3 | key\_length |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | one\_hot | req\_hmac\_0027 |  | One-hot encoded field. | functional | cfg\_cg.key\_length.key\_invalid | Martin |  |  |  |  |  | Means that non one-hot values should also be tested to be sure it doesn't break anything, in that case in should fall in key\_none. |  |
| 4 | arbitrary\_key\_length | req\_hmac\_0016 |  | The HMAC can be programmed with the following key lengths: 128-bit, 256-bit, 384-bit, 512-bit and 1024-bit. But the HMAC supports any arbitrary key length: the software should configure the HMAC with the next largest supported key length and concatenate zeros to reach the programmed key length. | functional | TODO | Martin |  |  |  |  |  |  |  |
| 4 | key\_length\_x\_hmac\_en | imp\_hmac\_0008 |  | The value of this register is irrelevant when only SHA-2 (not keyed HMAC) is configured. | functional | wr\_key\_during\_sha\_only\_cg | Martin |  |  |  |  |  |  |  |
| 4 | invalid\_cfg | req\_hmac\_0020 |  | However, for HMAC mode (\`hmac\_en \== 1\`), when HMAC is triggered to start while KEY\_LENGTH holds \`Key\_None\` or KEY\_LENGTH holds \`Key\_1024\` for DIGEST\_SIZE \= \`SHA2\_256\`, starting is blocked and an error is signalled to SW. | functional, functional, functional | cfg\_cg.hmac\_en\_x\_key\_none, cfg\_cg.key\_x\_digest\_mismatch, err\_code\_cg.hmac\_errors.invalid\_config | Martin |  |  |  |  |  |  |  |
| 4 | key\_none | req\_hmac\_0021 |  | Unsupported/invalid values and all-zero values are mapped to Key\_None. | functional, functional | cfg\_cg.key\_length.key\_none, cfg\_cg.key\_length.key\_invalid | Martin |  |  |  |  |  |  |  |
| 3 | digest\_size |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | one\_hot | req\_hmac\_0028 |  | One-hot encoded field. | functional | cfg\_cg.digest\_size.sha2\_invalid | Martin |  |  |  |  |  | Means that non one-hot values should also be tested to be sure it doesn't break anything, in that case in should fall in sha2\_none. |  |
| 4 | digest\_size\_x\_hmac\_en | imp\_hmac\_0007 |  | Select digest size for either HMAC or SHA-2. | functional | cfg\_cg.hmac\_en\_x\_digest\_size | Martin |  |  |  |  |  |  |  |
| 4 | invalid\_cfg | req\_hmac\_002A |  | Unsupported/invalid values and all-zero values are mapped to SHA2\_None. | functional, functional | cfg\_cg.digest\_size.sha2\_none, cfg\_cg.digest\_size.sha2\_invalid | Martin |  |  |  |  |  |  |  |
| 3 | key\_swap |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | key\_swap | req\_hmac\_002B |  | If 1 the endianness of each KEY\_\* register is swapped. Default value (value 0\) is big endian representation of the KEY\_\* CSRs. | functional | cfg\_cg.key\_swap | Martin |  |  |  |  |  |  |  |
| 3 | digest\_swap |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | digest\_swap | req\_hmac\_002C |  | If 1 the value in each digest output register is converted to big-endian byte order. | functional | cfg\_cg.digest\_swap | Martin |  |  |  |  |  |  |  |
| 3 | endian\_swap |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | endian\_swap | req\_hmac\_002D |  | If 0, each value will be added to the message in little-endian byte order. The value is written to MSG\_FIFO same to the SW writes. If 1, then each individual multi-byte value, regardless of its alignment, written to MSG\_FIFO will be added to the message in big-endian byte order. | formal | TODO | Martin |  |  |  |  |  |  |  |
| 4 | endian\_swap\_no\_impact | req\_hmac\_002F |  | A message written to MSG\_FIFO one byte at a time will not be affected by this setting. | functional | TODO |  |  |  |  |  |  |  |  |
| 3 | sha\_en |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | sha\_en |  |  | SHA core could be disabled. | functional | cfg\_cg.sha\_en | Martin |  |  |  |  |  |  |  |
| 4 | sha\_disabled\_allows\_config | req\_hmac\_0030 |  | SHA engine will not initiate compression, this is used to stop operation of the SHA-2 engine until configuration has been done. | functional | TODO | Martin |  |  |  |  |  | Check regsiters which are supposed to be write protected when sha\_en=0 |  |
| 4 | sha\_disabled\_digest | req\_hmac\_0031 |  | When the SHA-2 engine is disabled the digest is cleared. | assertion | TODO | Martin |  |  |  |  |  | Check that digest is cleared when SHA is disabled |  |
| 4 | hmac\_en | req\_hmac\_0002 |  | HMAC datapath enable. | functional | cfg\_cg.hmac\_en | Martin |  |  |  |  |  |  |  |
| 4 | hmac\_hash\_start | imp\_hmac\_000F |  | If this bit is 1, HMAC operates when \`hash\_start\` toggles. | assertion | TODO | Martin |  |  |  |  |  | Check that FSM is moving to a certain state only once this signal has been triggered |  |
| 2 | cmd |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/registers.html\#cmd](https://opentitan.org/book/hw/ip/hmac/doc/registers.html#cmd) | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | hash\_continue | imp\_hmac\_0010 |  | When 1 is written to this field, SHA-2 or HMAC will continue hashing based on the current hash in the digest registers and the message length | functional | save\_and\_restore\_cg | Martin |  |  |  |  |  |  |  |
| 3 | hash\_stop |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 4 | hmac\_done\_irq | req\_hmac\_0008 |  | When 1 is written to this field, SHA-2 or HMAC will afterwards set the hmac\_done interrupt as soon as the current block has been hashed. | assertion, assertion | TODO, TODO | Martin |  |  |  |  |  | One assertion can be added to the RTL and another one to the SB when hmac\_done read is detected |  |
| 4 | digest\_avail | imp\_hmac\_0011 |  | The hash can then be read from the registers DIGEST\_0 to DIGEST\_15. | functional | TODO | Martin |  |  |  |  |  | Add something to be sure that all the digest registers are accessed while checking against the expected |  |
| 3 | hash\_process | imp\_hmac\_0012 |  | If 1 is written to this field, SHA-2 or HMAC calculates the digest or signing based on currently received message. | functional | TODO | Martin |  |  |  |  |  |  |  |
| 2 | status |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | hmac\_idle | req\_hmac\_0033 |  | HMAC idle status. | functional | status\_cg.TODO | Martin |  |  |  |  |  | TODO: all of these means that it has been detected from the DUT register but not actually verified \! \-\> status\_cg.sta\_hmac\_idle |  |
| 3 | fifo\_empty | req\_hmac\_0034 |  | FIFO empty. | functional | status\_cg.TODO | Martin |  |  |  |  |  | TODO: all of these means that it has been detected from the DUT register but not actually verified \! \-\> status\_cg.fifo\_empty\_cross |  |
| 3 | fifo\_full | req\_hmac\_0035 |  | FIFO full. | functional | status\_cg.TODO | Martin |  |  |  |  |  | TODO: all of these means that it has been detected from the DUT register but not actually verified \! \-\> status\_cg.fifo\_full\_cross |  |
| 3 | fifo\_depth | req\_hmac\_0036 |  | FIFO entry count. | functional | status\_cg.TODO | Martin |  |  |  |  |  | TODO: all of these means that it has been detected from the DUT register but not actually verified \! \-\> status\_cg.fifo\_depth\_cross |  |
| 3 | fifo\_depth\_size | req\_hmac\_0006 |  | FIFO depth register field should be 6 bits width as the message FIFO has a depth of 32\. | formal | TODO | Martin |  |  |  |  |  |  |  |
| 2 | err\_code |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | err\_code | req\_hmac\_0037 |  | If an error interrupt occurs, this register has information of error cause. | functional | err\_code\_cg | Martin |  |  |  |  |  |  |  |
| 2 | wipe\_secret |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | wipe\_internal\_variables | req\_hmac\_000A |  | If CPU writes a value into the register, the value is used to clear the internal variables such as the secret key, internal state machine, or hash value. The clear secret operation overwrites the internal variables with the provided 32-bit value. For SHA-2 384/512 that work with 64-bit words, the 32-bit value is duplicated and concatenated to generate the 64-bit value. | testcase, formal | wipe\_secret, TODO | Martin |  |  |  |  |  |  |  |
| 2 | key |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | key\_order | imp\_hmac\_0013 |  | Order of the secret key is: key\[1023:0\] \= {KEY0, KEY1, KEY2, ... , KEY31}; | functional | cfg\_cg.hmac\_swap\_x\_key\_length | Martin |  |  |  |  |  | Covered by the C model as the returned digest is matching |  |
| 3 | key\_update | req\_hmac\_0039 |  | The registers are allowed to be updated only when the engine is in Idle state. If the engine computes the hash, it discards any attempts to update the secret keys and report an error. | functional, functional | wr\_key\_during\_hash\_cg, err\_code\_cg.hmac\_errors.update\_secret\_key\_in\_process | Martin |  |  |  |  |  |  |  |
| 2 | digest |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | key\_write\_only | req\_hmac\_003A |  | The key register should be only write accessible. | formal | TODO | Martin |  |  |  |  |  |  |  |
| 3 | digest\_order | imp\_hmac\_000A |  | Order of the 512-bit digest\[511:0\] \= {DIGEST0, DIGEST1, DIGEST2, … , DIGEST15}. For SHA-2 256 order of the 256-bit digest\[255:0\] \= {DIGEST0, DIGEST1, DIGEST2, DIGEST3, DIGEST4, DIGEST5, DIGEST6, DIGEST7} and {DIGEST8 \- DIGEST15} are irrelevant and should not be read out. For SHA-2 384, {DIGEST12-DIGEST15} are truncated; they are irrelevant and should not be read out. | functional | cfg\_cg.digest\_size | Martin |  |  |  |  |  |  |  |
| 3 | digest\_clear | req\_hmac\_0031 |  | The digest should be cleared when CFG.sha\_en transitions from 1 to 0\. | assertion | TODO | Martin |  |  |  |  |  | Add an assertion to be sure that the digest is cleared in that case |  |
| 3 | digest\_access | req\_hmac\_003b |  | When \`STATUS.hmac\_idle\` is 1, these registers can be written to by software. | functional | wr\_digest\_during\_not\_idle\_cg | Martin |  |  |  |  |  |  |  |
| 2 | msg\_length |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | msg\_length\_split | imp\_hmac\_0014 |  | For SHA-2 256 computations, message length is 64-bit {MSG\_LENGTH\_UPPER, MSG\_LENGTH\_LOWER}. For SHA-2 384/512 message length is extended to 128-bit in line with \[nist-fips-180-4\] where the upper 64 bits get zero-padded: {32’b0, 32’b0, MSG\_LENGTH\_UPPER, MSG\_LENGTH\_LOWER}. | formal | TODO | Martin |  |  |  |  |  |  |  |
| 3 | msg\_length\_access | req\_hmac\_003c |  | When \`STATUS.hmac\_idle\` is 1, this register can be written by software. | functional | wr\_msg\_len\_during\_not\_idle\_cg | Martin |  |  |  |  |  |  |  |
| 2 | msg\_fifo |  |  |  | section\_title |  |  |  |  |  |  |  |  |  |
| 3 | msg\_fifo | imp\_hmac\_0015 |  | Message FIFO. Any write to this window will be appended to the FIFO. Only the lower \[1:0\] bits of the address matter to writes within the window (for correctly dealing with non 32-bit writes). | functional | TODO | Martin |  |  |  |  |  | Weird write accesses should be tested to be sure that we are able to correctly deal with non 32-bit writes and also to be sure that only the lower 2 bits are used within this range. |  |
| 1 | programmers\_guide |  |  | [https://opentitan.org/book/hw/ip/hmac/doc/programmers\_guide.html](https://opentitan.org/book/hw/ip/hmac/doc/programmers_guide.html) | section\_title |  |  |  |  |  |  |  |  |  |
| 2 | sar\_registers | req\_hmac\_0005 |  | The context that needs to be saved and restored is in the following registers: CFG, DIGEST\_\*, and MSG\_LENGTH\_\*. | functional | save\_and\_restore\_cg | Martin |  |  |  |  |  |  |  |
| 2 | error\_codes | imp\_hmac\_0016 |  | When HMAC errors are triggered, the IP reports the error via INTR\_STATE.hmac\_err. The details of the error type is stored in ERR\_CODE. | functional | err\_code\_cg | Martin |  |  |  |  |  |  |  |
