#!/usr/bin/python3
# Copyright lowRISC contributors.
# Licensed under the Apache License, Version 2.0, see LICENSE for details.
# SPDX-License-Identifier: Apache-2.0
import argparse

import sqlite3


def print_row(header, row):
    for col_name, val in zip(header, row):
        print(f"{col_name:>25}  {val}")
    print("\n")


def main():
    parser = argparse.ArgumentParser(
        prog="OT Device Registry viewer",
        description=
        "A utility for dumping the contents of the OT device registry",
    )
    parser.add_argument("db_path",
                        help="Path to .db file generated by orchestrator.py")
    args = parser.parse_args()

    conn = sqlite3.connect(args.db_path)
    cursor = conn.cursor()

    res = cursor.execute("SELECT * FROM OT_EARLGREY_DEVICES")
    rows = res.fetchall()
    col_names = [desc[0] for desc in cursor.description]

    for i, row in enumerate(rows):
        print(f"[Row {i}]")
        print_row(col_names, row)


if __name__ == "__main__":
    main()
