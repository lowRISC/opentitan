// Copyright lowRISC contributors (OpenTitan project).
// Licensed under the Apache License, Version 2.0, see LICENSE for details.
// SPDX-License-Identifier: Apache-2.0

#include "sw/device/lib/testing/test_framework/check.h"
#include "sw/device/lib/testing/test_framework/ottf_main.h"
#include "sw/device/silicon_creator/lib/sigverify/sphincsplus/verify.h"
#include "sw/device/silicon_creator/lib/sigverify/spx_verify.h"

/**
 * Generated using:
 *
 * ```
 * # Private key (not used, for reference only)
 * opentitantool spx key generate <OUTPUT_DIR> test_key
 * cat test_key.pem | tail -n +2 | head -n -1 | base64 -d | \
 *     hexdump -v -e '/4 "0x%08x, \n"'
 * # Public key
 * cat test_key.pub.pem | tail -n +2 | head -n -1 | base64 -d | \
 *     hexdump -v -e '/4 "0x%08x, \n"'
 * # Signature
 * echo -n "test message" > test_message
 * opentitantool spx sign -o signature test_message test_key.pem
 * cat signature | hexdump -v -e '/4 "0x%08x, \n"'
 * ```
 */
static const char kMessage[] = "test message";
static const size_t kMessageLen = sizeof(kMessage) - 1;
static const uint32_t kPrivKey[] = {
    0xf54ec8c7, 0x31112318, 0xef4eb42d, 0xb33a8bed, 0x48353913, 0x2ebafb0e,
    0x8194c228, 0x603a35a9, 0xa23b5d15, 0x4db20189, 0xa240ce5a, 0x85b9169e,
    0x7679c7b8, 0xf73998fc, 0xd2c1b3d2, 0xcd9108e3, 0xf54ec8c7, 0x31112318,
    0xef4eb42d, 0xb33a8bed, 0x48353913, 0x2ebafb0e, 0x8194c228, 0x603a35a9,
};
static const sigverify_spx_key_t kPubKey = {
    .data =
        {
            0xf54ec8c7,
            0x31112318,
            0xef4eb42d,
            0xb33a8bed,
            0x48353913,
            0x2ebafb0e,
            0x8194c228,
            0x603a35a9,
        },
};
static sigverify_spx_signature_t kSignature = {
    .data = {
        0xedfc61e1, 0x9c4801cc, 0x57cb1708, 0xda39e35b, 0x1f35c0a6, 0x6b9dd613,
        0xf0bc23e6, 0x779adc4a, 0x5ab58cf4, 0xbc12ef55, 0xaddb9f78, 0x9b8c7125,
        0x02f658e7, 0xd94e9e7f, 0x26f2f74b, 0xeebdf202, 0x010301f3, 0xcc7c3bbb,
        0x0112686c, 0x55de2699, 0x1f8baf53, 0xf17644a5, 0xb2edf530, 0x3edec2b4,
        0xaa1d388d, 0xe3ac2cf7, 0x022ecacd, 0x9fb3ae04, 0x94655197, 0xac2d996b,
        0xdc737c0d, 0x28900159, 0x84b50ca5, 0x7129ecc1, 0xc7320313, 0x0e656db5,
        0x96f8fbd1, 0xae0b67ab, 0x45f0f679, 0xf2c76b53, 0xd5a56abb, 0x7da4e983,
        0xac899817, 0xb8f37cd1, 0x5f99f7d9, 0x02c43a8a, 0x86d1ef20, 0xcf4476e7,
        0xd8da64ba, 0x6e2e0005, 0x53dab50b, 0xef1c7f6a, 0x0fd634c1, 0x70b28702,
        0x5b59da2d, 0x754ea04b, 0x0239a1c6, 0x7083478e, 0x3c5189f3, 0x0bbab5fe,
        0x380b0546, 0x31659948, 0x58244281, 0x36680d66, 0xb42fdacc, 0xa5f1d020,
        0x87c56f24, 0x6702ce2e, 0x03722cb0, 0x2fdcef17, 0x0fe18c0a, 0x2ce852bf,
        0xddbb2ae4, 0xb120f8c7, 0xf9cbd5de, 0x185a0d89, 0x923e5aea, 0x7c168110,
        0x0ac57488, 0xc948af35, 0x3a0655e9, 0x82146222, 0x303d0efa, 0x400ed03c,
        0x72c2bfe2, 0x6387f2c4, 0xe64472e0, 0x059957c2, 0xe33bc9b3, 0x78ccb32e,
        0x907a3df7, 0xcabff212, 0x5417f5fd, 0x7ff2fac8, 0x910ba38a, 0x88f5bf03,
        0xf2c21b7a, 0xaefa9ed1, 0x8b9b6dab, 0xde2cebd0, 0x700c9153, 0xe0b62003,
        0xc3a637e5, 0x75fd0db0, 0x0d62acec, 0xaca29af0, 0x75cc94f1, 0x2ba3c266,
        0x8a828b69, 0xdc0ba998, 0xf831e0ca, 0xf91bea95, 0x173d4570, 0x74e96f90,
        0xbba6e622, 0xce047a48, 0x707d5476, 0xbc2124db, 0x708232e5, 0xe5965878,
        0x36441ff5, 0x87539ba8, 0x1bceb4a0, 0x55346ee4, 0x9e9ed718, 0x15cccb5f,
        0xaad3a117, 0xe5bae96d, 0xe2551894, 0x6e92b0e6, 0x4b60506b, 0xf284fbd8,
        0xce9b7952, 0x5de3fa63, 0xeb49eb28, 0x10109eb0, 0x82fca860, 0x3ab87418,
        0xba4ff8da, 0xc2457254, 0xc8e99711, 0x79b21b73, 0x52fa979c, 0xcfdf3221,
        0xedd6cace, 0x193c963b, 0xc5899036, 0xcce3fab2, 0xb733c3a0, 0x9089e7ed,
        0x9c0a4603, 0xb6beeb1b, 0x3d56156b, 0x50c90ecf, 0x8dc23059, 0x1c51a0b3,
        0x78f24730, 0x593dca54, 0x976596ee, 0x24280e1f, 0x610b39ce, 0xefae1e46,
        0x25a6f5cb, 0x59b80261, 0x7078d9c0, 0xa679ee8d, 0xab1ba790, 0x5148609d,
        0xc68ef3f4, 0x1c6f1f51, 0x8076093c, 0x49b0773a, 0x902dfe5d, 0x3e02558b,
        0x642021a8, 0x8f3ab88b, 0xace024dc, 0x2f8737eb, 0x46fbe4f3, 0x62096804,
        0x93204e99, 0xa46f0331, 0xbdb0cd3e, 0xe7063bfd, 0xa2345377, 0x6751dc6c,
        0x322fd066, 0x704675da, 0x63cf9699, 0xa8139f18, 0xebdd6b1e, 0x2f65d88a,
        0x3a9f29d8, 0x45f46008, 0xd8b879d6, 0xe2b381d3, 0xe4a8e46d, 0xa655570a,
        0x71004983, 0x3cf00d16, 0xfa0abc43, 0xbda75d86, 0x80229964, 0x56b09bfd,
        0x7acc80c2, 0x6e8ce58b, 0x93f4bcaa, 0x43315ea4, 0xc72bebd2, 0x53dfa819,
        0xb477b457, 0xa376faaa, 0x6e2b4a3f, 0xd9e841f2, 0xbf7bcf3c, 0x39933922,
        0x876a4f7c, 0x4ef99ebd, 0x8aae12db, 0xe7934b1d, 0x4cb809f0, 0xe067dd64,
        0x00703450, 0xd509a823, 0x21bfd5a8, 0xfec7afd2, 0xaa7836d0, 0x2fa0ce46,
        0xb95f2220, 0x25103adf, 0x3c864f56, 0x3825d363, 0xd75ef4ba, 0x7421eb6f,
        0xaf42aa95, 0xe154c726, 0x58ddf022, 0xfb809d14, 0x025d5265, 0x7028ac05,
        0x9e3a258c, 0x30f48176, 0x0c5787ad, 0x71a7d099, 0xbaf9d0ff, 0x0bcaec20,
        0xfb02f765, 0x68a861e5, 0xe2c7551c, 0x63d8734b, 0xd7071dd5, 0x29a6fb55,
        0x3b794356, 0x99852dfe, 0xfe486ede, 0xf436354d, 0x6d9be558, 0x1cc832b3,
        0x7a2627a1, 0x2c5088a0, 0x2e34ffc7, 0x40991dc8, 0x05d0d24b, 0x9975caca,
        0xe30d7193, 0x48278c93, 0xf96b7e46, 0xfa94322e, 0xee694201, 0x1bb87374,
        0xd4de82b5, 0xa60028fd, 0x927cb6a8, 0xb9e49584, 0x3faeed5d, 0xaa161ec8,
        0x836c60e8, 0xea6eec62, 0x275e999d, 0xa5423350, 0x67e04a7c, 0x17765ff6,
        0x0a332197, 0x6b84a1ab, 0x7fb82238, 0x01dab713, 0x80a05c44, 0x1013bd2f,
        0xbc4cb75b, 0xde23ee9e, 0x56a400ef, 0x0d58f46b, 0x8f876f60, 0x3430d6ff,
        0xcccef2fd, 0x5d2a41d1, 0xf2aa7df7, 0x5c78a0e7, 0x856ccaa1, 0x4acbec97,
        0x5bc353c6, 0xd87ce91d, 0xb392b963, 0xe8400ea5, 0x6b94da14, 0xb75df653,
        0x97c2b0f7, 0x38bb5b78, 0x6b873952, 0xe5a66e33, 0x541d096b, 0x2f228b9e,
        0x03c88f08, 0x43e03233, 0x9b987d07, 0xb9d7864b, 0x10153d7c, 0x93332a6b,
        0xf9673ef9, 0x29302068, 0x01e80026, 0xb2f395d3, 0x8fa34065, 0x555eaa0d,
        0xd1b5e4d2, 0x4a10a497, 0x02713a72, 0xfc75e241, 0x366c84ce, 0xdf152263,
        0x79ca6244, 0xb010a8ee, 0xd3d8c2cd, 0x4c2342a9, 0xeea50bc9, 0x3d023059,
        0x64457377, 0x9ff6747f, 0xe3809ff8, 0x15e01bb9, 0x649242d9, 0x77dbde4e,
        0xa964b102, 0x0cac5393, 0x102de08f, 0x029cfe5b, 0x9f087afd, 0xac09d077,
        0x0984e8fb, 0x58b53ba5, 0x760c2420, 0xc192b2d2, 0x35d70c45, 0x44bd1cf9,
        0xf08385cc, 0xc014f229, 0x64116c5b, 0x8f3831b4, 0xc56b6244, 0xeb0e8e56,
        0x98ae03d7, 0x874c8ab6, 0x2b8dc695, 0xfc2643e3, 0x1cfc695a, 0xa2ccb0b6,
        0x3f4e5a92, 0xfa1bee2f, 0x7b269676, 0x577ceddf, 0x82c41db6, 0x33a21fcd,
        0x06a101b5, 0x0573eaaa, 0x2cea085e, 0x9132a4c8, 0xf1d8df29, 0xd15bb38c,
        0x1e599d11, 0x2bc864a5, 0x0400d4dd, 0x36897769, 0x9c4d3af6, 0xeb23ee63,
        0x5b4a6588, 0xa70b9528, 0x0818d51f, 0x200e7190, 0x256ec670, 0x0bd24de4,
        0xc88347e9, 0xd54e6235, 0xd1ffcfe8, 0x0a9d4bc0, 0x24293e3f, 0x9c2c6a25,
        0xdf197ea8, 0x01b9eb00, 0xfb43a35a, 0x171398b8, 0x6a21663a, 0x1b2f3477,
        0xd4424414, 0x33f9da01, 0x98793b95, 0xdcb42bde, 0xe1dfe925, 0x1aad54ba,
        0x2a124147, 0xbdfdcc50, 0xd6fd859a, 0x0754065c, 0xb5602e56, 0x38632096,
        0x4b5f34f8, 0xdc7f44c2, 0x2e6d7a05, 0xdb3e08b4, 0xbfb8a53d, 0xe1b6742e,
        0x6ef824ae, 0x98febf10, 0x643c2c2c, 0x5d311e0a, 0xd06623d7, 0x268631fd,
        0xbef6c999, 0xce32e9d5, 0xc51de823, 0x6a39dd4f, 0x5c0e76ae, 0x9e03f193,
        0x52e2f3a6, 0xe6b6e09e, 0xdc6af0ab, 0x622ab8c4, 0x433e413c, 0x92050eb9,
        0x02a7752f, 0xcdc46e33, 0x979628f1, 0x54094804, 0x7428b3fe, 0x54ba031a,
        0x2633520a, 0xe77ed76c, 0x5e6e936f, 0x2c6f06ba, 0x788907f7, 0x133f2b69,
        0x4c05652c, 0xd439405b, 0x9965c480, 0xa10958f1, 0xa83d1312, 0x9dd92ada,
        0x69831256, 0x572a85eb, 0x2f8059fd, 0xd35425f0, 0x6295db8c, 0xb5b7085b,
        0xbe76d663, 0xab808521, 0xf3c3b240, 0x5795d39d, 0xa7e73e39, 0x28979956,
        0x13a33f08, 0x5ad735e8, 0x5d01757a, 0x0361149e, 0x07ce2721, 0xd5861702,
        0x2ffed155, 0xa4ef788f, 0x1e7e0988, 0x6ee479ef, 0xdb556846, 0xd55a2929,
        0x8c031035, 0x5ac62703, 0x333acce4, 0x2ac9dd4c, 0xdb809682, 0x6a8b143d,
        0x3dfd831e, 0x63ee2c68, 0x2e1fa594, 0x007ddf78, 0xf0ac1116, 0x23e3e61c,
        0x674603d9, 0xa10eb11e, 0x5fa35080, 0x24458214, 0x133bf105, 0x1f21b8a0,
        0xb390978b, 0x016a097b, 0xfb4510e5, 0x40e727ef, 0x16883174, 0x57fea1a1,
        0x44371ec6, 0x1dff10d2, 0x3e6d9a7e, 0x1286aba3, 0x1ac7ec20, 0x761b2a43,
        0x77472bde, 0x8494c321, 0xd8a56f06, 0xf09bfd0c, 0x6e3726aa, 0x87d075ee,
        0x15f53fc1, 0x157ec8b2, 0xbc63184c, 0xec048ceb, 0x797815e7, 0x677e3994,
        0x223be2bd, 0xcf450412, 0x058e9cce, 0xbd1ab021, 0xf9cbff9c, 0x6b594956,
        0x88c03005, 0x4cfd2b14, 0x50062ccd, 0x2d71a01d, 0xd3746fb5, 0xb984e80f,
        0x412533f5, 0xb9593b56, 0x9a8a5e57, 0x71250c09, 0xe2c5d794, 0x9f7c8cb0,
        0x6efce42a, 0x1a67528e, 0xe0c52107, 0x0b915b50, 0x94de1761, 0x87c4b9d1,
        0xb390780a, 0x06e05127, 0xf6dcc49d, 0xff737a92, 0xdec7bac1, 0x4ef02177,
        0x15026400, 0x4c443cc7, 0xc06a0d03, 0xe3562b05, 0xba23e36d, 0x3bca28c9,
        0x93c4a5f3, 0xa0f5759a, 0xa03a75a1, 0x018d562a, 0x587fbe53, 0x398fdf3b,
        0x23f3b162, 0x31383266, 0x0074aece, 0x8d7f0eea, 0x7ae72c24, 0x8eb45da0,
        0xa6f11a0c, 0xd1974a49, 0xac0fa6ad, 0xa187cb4a, 0x7e37257c, 0x58245047,
        0x2e733b10, 0x2a551266, 0x3f7c8b7c, 0xc78c6633, 0x5f12f9ce, 0xd45434d9,
        0x4b56da8b, 0x7723ff59, 0xf33fadd5, 0x70d633a7, 0x44643408, 0xbdd99cf9,
        0x66525b0e, 0x71151ccf, 0x0dca3190, 0x78481a8d, 0xcf2e7a50, 0xa1b32eeb,
        0xae8c5a25, 0x2b7ea517, 0x87c6f48d, 0x7d2fdc55, 0x5fb19f6b, 0x41b99cc9,
        0x5beecfbc, 0x50ddb3da, 0x4a395ec4, 0x6f8848f3, 0x635e6274, 0x0066907c,
        0x576bfe7b, 0xe274707f, 0xfc9fde67, 0xac202df6, 0x5ac5bcd8, 0xe0df1ce8,
        0x61f7c52c, 0x41110540, 0xb51ccb51, 0xf3fb0e44, 0xc08bc267, 0xdabe8508,
        0x4954371f, 0x1fbe54c8, 0x0436449c, 0x65b23b19, 0xe0e1087a, 0x0a3d36f4,
        0x99277f3e, 0xf22014ee, 0x6e72ab30, 0x7659f4b1, 0x8cabdf62, 0x6f45ff29,
        0x7c87bf28, 0x7e5c3f45, 0x194de0d2, 0x092a5f46, 0x2c20a436, 0x2a06ed01,
        0x2b49a8d2, 0x8f12f9b7, 0x6a8c13c3, 0x13a852fe, 0x2c26f9ef, 0x9f8cbb28,
        0xc5af7700, 0x3efcd705, 0x5e3f06db, 0x8036b389, 0x0e2abe98, 0x77b3378d,
        0x91d313b7, 0xc67348cc, 0x2d332636, 0x8a872320, 0xcaf338a3, 0x920728aa,
        0xd0213d27, 0x429fcb98, 0x08fec011, 0xb9ec4698, 0x3388e333, 0x46db2dec,
        0x03f3ecd0, 0xe4ab821d, 0x98d24b5b, 0x6d418cdc, 0xeeab766c, 0x2b8f6e5f,
        0x03716e3f, 0xecbf6a31, 0xb26d6bc6, 0x66c4bfa5, 0xb4d3d549, 0x41a2bb96,
        0x7211bcb4, 0x550ee2a5, 0x94ec6398, 0x0fe06e90, 0xb8987115, 0xe1dc22bc,
        0x0487d0d6, 0xf4e6e172, 0xb04d67ba, 0x28218c94, 0xad4f65e3, 0xf2865995,
        0x30301843, 0x47962281, 0xd1a72860, 0x49dbdf34, 0x4bb5ba43, 0x6ad0cfdd,
        0x8d10096e, 0x9ee69a68, 0xbd8fc43f, 0xd22b32ba, 0xb1a9d1be, 0x8ec37e4c,
        0x4efb9a91, 0x181f0b24, 0xaaecf7eb, 0x24915472, 0xbc7d251b, 0xd3e26af4,
        0xa76fcc47, 0xa75a628f, 0x8eb6fe67, 0x0878d359, 0x3db7c9fe, 0x118f255e,
        0x0eedb937, 0xd80323d1, 0x81c298ce, 0xa2b2cc14, 0x6a3d34fe, 0xc2a54143,
        0xc83ab5d8, 0xb821e79b, 0xaa97ceb5, 0x8d48b541, 0xe7e28476, 0x34cdaaeb,
        0x2c0dea69, 0x8e1e57d0, 0x3e9ceb41, 0xf05be911, 0xf760dfd6, 0x4cdd067a,
        0x13e28b6e, 0xea69eb93, 0xbdf31eff, 0x34a6b61c, 0x97b3b8d0, 0x0500bf29,
        0x22ce98cb, 0x5b591c60, 0x3c9f80f5, 0x558668a5, 0xc5c4b8a6, 0xebf9b9fd,
        0x5cfe690b, 0x377be07b, 0x0af94d41, 0xfccef52e, 0xa348dd0d, 0xb01af77c,
        0x338ab7a9, 0x6f776d23, 0x895420b4, 0xc50bc373, 0x15a3c369, 0x4d13b4e3,
        0x849f838a, 0xa8bb4b10, 0x93b91b0f, 0xc9638dd1, 0x727bc40c, 0x8be4b4e9,
        0xfd029c7d, 0xa2d3234c, 0x5b4bf8ea, 0x89301ace, 0xe3ab73c2, 0xbf238128,
        0xb86617fc, 0xcaf472e9, 0xa216b162, 0x0164d13d, 0xcfa7dd52, 0xa7a3d05f,
        0xa77fbeef, 0x110ef104, 0x865a901b, 0x37d11e30, 0x5fb6ac06, 0xc2412439,
        0x41cbd349, 0xe83ae238, 0xfe141e00, 0x5a8ea6af, 0x36e5a918, 0x52ca4ad6,
        0xd7a995c6, 0x73a3130d, 0x023ee5b2, 0xefe082ec, 0x8e3d642d, 0x0a11fbf2,
        0x580395fc, 0x1ac089d3, 0x791eee65, 0x2944ced4, 0x7e72929d, 0x2513da72,
        0xc1bff22b, 0xf2838a3a, 0xbf60c75a, 0x4c12e795, 0xca34dece, 0x0c9172e8,
        0xa671d3ca, 0x09645188, 0xa67b73fb, 0x0041cb12, 0xae8dff5d, 0x7532718e,
        0xa2d70ed8, 0x157e9152, 0x2638c0f6, 0xcb35307c, 0x2dc6bcad, 0xe76ea2bd,
        0x31393877, 0xc739e9c5, 0xb8a8cc46, 0xfc5c67f4, 0xb2626d7e, 0x8692038b,
        0xfd38af37, 0x1a4e7d41, 0x5c6e02c1, 0x77ada513, 0xd476d866, 0x724edea5,
        0xf3db33e9, 0xaa71808f, 0x8999554c, 0x7cab4d1a, 0xb3dde4a9, 0x2e8cba71,
        0x4d9a05ab, 0x46aa18f7, 0xe4b20bc0, 0x9e6bd626, 0xa0924a5c, 0x332a77ee,
        0xfd0b8e86, 0xfeff6bdd, 0xb34f4e4a, 0x497f0479, 0xaffc5b8d, 0xd8bb06ad,
        0x72c84b93, 0x0084122e, 0xca38d81e, 0xaf9c5036, 0x70e499cf, 0xe4368cad,
        0xcd9468ad, 0x011126dd, 0x0d441ba8, 0x84a19ce2, 0x86e27ad5, 0xaac05a1c,
        0x7754662e, 0x4fbc1edb, 0x250aea9e, 0x2b2b1e62, 0x6d819e5d, 0x4fa954d6,
        0xda05eab5, 0x5a9e60a0, 0xc7174228, 0xa4a9b74e, 0x46cbb4f0, 0x48e56f9c,
        0x705d388a, 0x8a0f8a3c, 0xbb06f61f, 0xb93cbe9a, 0xecd8cbf6, 0xecc4795f,
        0x4145884b, 0x0513d280, 0xff264d5a, 0x93b4a730, 0x1e911b97, 0xae8550e3,
        0xfcfa82a8, 0x6bc41b49, 0x365159ce, 0xd17d3643, 0xcf923964, 0xd37c1ec5,
        0xf79d08c8, 0x62906f02, 0x9410e1c2, 0xea21e3b9, 0x0829157f, 0xbbbd7549,
        0x7eabe844, 0x3ac3a715, 0xc8a5aaa8, 0x346ec1a1, 0xa3acf23b, 0x3b1f8fdb,
        0xd6fac13f, 0x0d7f8e88, 0x10e305e8, 0xa53ee7a2, 0x7911da6e, 0x0efe4abd,
        0xf4559fa0, 0xdfe295d9, 0x26ac4874, 0x485f6714, 0x82e4e1b4, 0xa4f400f0,
        0x404e808d, 0x49379f34, 0xa85d131f, 0x4f8b4cad, 0x6e09fd64, 0x64a80c3c,
        0xb3c2e53f, 0x303821ba, 0x433c19a7, 0xf5bad6c2, 0x3cbe8d1c, 0x561bba6e,
        0x96f16ef7, 0xf54530b1, 0xdef5d568, 0xb0a84de5, 0xf1e9ed7a, 0xb4f24620,
        0x3aa86056, 0x9db2e1fc, 0xaa175858, 0x0a2d3f65, 0x8cd8ca29, 0x46785f5e,
        0xdfbe4f68, 0x160257e9, 0xfe7ec0bb, 0x4f6d1a39, 0xe852b623, 0xfa7ab8ec,
        0x97acab22, 0x8ee03839, 0x7c1d9b72, 0x7024d5d3, 0x02a1ce7b, 0xee48c04d,
        0x4ed2d064, 0xbcb526ae, 0xac411f7d, 0x95d5b5e0, 0x7058b9a4, 0xc5b23ca0,
        0xf7c30a00, 0x44a14fb3, 0x03a3c7c1, 0x1f1271b6, 0x498434a8, 0xd3070e7a,
        0xa5f11218, 0xe9f1058c, 0x8c125e69, 0x8a152bfc, 0xff4374d7, 0x27f2d4f3,
        0x18540b73, 0x524a52a1, 0xe8e315cb, 0xd14968a6, 0xdf4923ea, 0x39e72f88,
        0x035ee41d, 0x5a289e13, 0x5ee12c0e, 0x72dc3f6c, 0xda9b7dcd, 0x00f413db,
        0x89803754, 0xbbe808e6, 0xe43f399b, 0xc9b9f866, 0x4b2eaf26, 0xc0a036e0,
        0x7c17bbba, 0x6e0fff7d, 0x8fd91990, 0x15fb6242, 0x3d3ea173, 0xe0ff9df9,
        0x4f9cefad, 0x664794e9, 0xf1cf8b7c, 0x3d876832, 0x1a599b50, 0x44cbefc5,
        0x58e612d4, 0xf5b529c7, 0x037d5a71, 0xf85cd2b1, 0x14180b3c, 0x157eca74,
        0xbf376787, 0xb40c7a90, 0x6a689453, 0xb9406a34, 0x7a4ea59e, 0x157222b3,
        0x40590c3b, 0xe9d93435, 0x0041cdcc, 0x5ca93bbd, 0xde4f6948, 0x07dbf583,
        0x8b814d57, 0x7ba76ce3, 0x9459b0e5, 0x06ddfc58, 0xc54f1476, 0xe4ec44c9,
        0x27193a66, 0x48e17346, 0x9017e70b, 0xdc0f58be, 0x84775da1, 0x8fe0c9f9,
        0x4d01da1f, 0xc1ab8121, 0x4628cc21, 0x8ad96a21, 0x7f5530f2, 0xe7eb8348,
        0x671593e6, 0x27a1533d, 0xa934abff, 0x58f5c6f5, 0xf55d00df, 0x31e40b5c,
        0xaa12360d, 0xd535a7a1, 0x46ad7ff0, 0x2a472c8d, 0x9abbd936, 0x5fa99caa,
        0xc8454da2, 0xd199374d, 0x0382d224, 0x744d622d, 0x42c002d6, 0x6d3d4fc2,
        0xe0cfa503, 0xb44ed8b1, 0x90513859, 0xe6aaba29, 0x2616a1d0, 0x0f14b405,
        0xfca8962d, 0xe5e1109a, 0x9815b2b9, 0x9462b564, 0x9e38bafa, 0x09e620db,
        0xca62bd7d, 0xd33bb035, 0x4d98643c, 0x6dd2b2d2, 0x4709f4ed, 0xa8298175,
        0xac9efbb8, 0x583c738d, 0x9fe67815, 0xf2a0d38b, 0x12abd549, 0x2547294d,
        0xd56587a7, 0x3a0ead61, 0xa933a9f8, 0x2c604132, 0xa49faa5b, 0x751375b6,
        0x28fbc8b4, 0x59231069, 0xa6150241, 0xc4a3611d, 0x21918d9c, 0xe72e4249,
        0xc2031b72, 0x938ed0d0, 0x9a00a86c, 0x42e7de37, 0xc7a0b545, 0xf66953ab,
        0x0ce036a9, 0x9f0c4919, 0xfd37e3c7, 0xbef55d50, 0xe469fc83, 0x3b3979d5,
        0xf388a5b4, 0xc8ee4a40, 0xaf564152, 0xdd0a79f0, 0x80ca1ff5, 0x164d93bb,
        0x2c4d5aae, 0xa35eb124, 0x15b58301, 0xf39c25dd, 0x8ac14942, 0xa47c077d,
        0xbed4685e, 0x61db134a, 0x145d5941, 0x23971bc9, 0x726288a7, 0xcd0fc8b8,
        0x28a8b312, 0xb34ff2cb, 0x256c54c2, 0x2e36c762, 0x05c4577e, 0x4827a27a,
        0xbe16e1c5, 0x7c76207c, 0x291178fc, 0x36b79681, 0x6b0f3dc7, 0xe8ed8f7b,
        0x35ca12b8, 0x60711011, 0x67bf08d5, 0x54a603a7, 0x68503fb6, 0x6a200e74,
        0xd38df5f6, 0x3f0aa9ea, 0x2dbb8d9f, 0xfa69bc1c, 0xb1e7a6aa, 0x1ffe05a7,
        0xe2f08569, 0x6f2af1fa, 0x2ab570e0, 0x67925d76, 0xd3c1900a, 0x9618e457,
        0x48365e28, 0x34d36392, 0x8d542747, 0xd953cff2, 0x923aed93, 0x4ddb72b5,
        0xdd2e86e0, 0xe33c3234, 0x0e135cb3, 0x0b10f0bc, 0xdf1703f4, 0xd5f1d783,
        0x1ecc64ab, 0x875fee4e, 0xb58df44d, 0x153dc102, 0x37617e03, 0xb5db1448,
        0xd11222bd, 0x387323ba, 0x76962224, 0x1846c2fc, 0x7b754f19, 0x78c07e1f,
        0xd06c2b74, 0xe873df6b, 0xdbacbc69, 0xb3e551bb, 0x10555ee3, 0xf9e3b232,
        0xba52acba, 0xa6739c2c, 0x6168557a, 0x19a6af6b, 0x3a32ee91, 0xe6a1e199,
        0x4bb344dd, 0xcba884b4, 0xa125ce6a, 0x73d6b920, 0xfa3ae88a, 0x9d4e1166,
        0xfecd4f3a, 0xfbed25de, 0x604b2cf0, 0xa608d7ca, 0xd9ffddd5, 0x935af842,
        0x75b19b5d, 0xef102841, 0xc86b5975, 0x1a3bd470, 0xbcd7a39f, 0xb0a71701,
        0xc62fc704, 0xd33f030e, 0x69ba9879, 0x18bf1536, 0xef5170ad, 0x1400c11a,
        0x291e08cd, 0xa5f5fffb, 0x7e553317, 0xc8262d59, 0x3e8e9498, 0xf0c8426c,
        0x7377e751, 0x5d54daf3, 0xa4adcebd, 0x8c5b9906, 0x7f4b195e, 0x659ac4b6,
        0xa7c5de0d, 0x99dff3e8, 0x5048c7ec, 0xb31b5782, 0x1554c91b, 0x90e23328,
        0xd347b977, 0xc4742dad, 0x0ab16abc, 0x81e45ad7, 0x6d5d6c07, 0x7ac1857a,
        0xaa91205b, 0xf5d2ee8e, 0x97fae6c0, 0xf43f87e8, 0x7e702455, 0x10295d44,
        0xc119380b, 0x80f87db8, 0xe32b29eb, 0x0ac54fb8, 0xa3346c4b, 0xc73041ce,
        0x178ad039, 0xd5bc81df, 0x8e79b686, 0x6f5f1899, 0x98437b11, 0xd4fb67fc,
        0xf827a844, 0x63b5e1dd, 0x6b8aa329, 0x6e752b92, 0xa5edb11d, 0x8a649ec6,
        0x5c0d4ac1, 0x1c8a4ef2, 0x018fcedf, 0x9652444c, 0x28822db5, 0x91096d88,
        0x37252f7d, 0x4d2713d2, 0xd352670f, 0x35b2f8b2, 0x9eb97d3e, 0x50eea2fe,
        0x9b7eed6c, 0x2a688517, 0xc3d6cc09, 0x2da30104, 0x89bedc4b, 0x18767e98,
        0x85e8296d, 0x5cd67712, 0x8319354b, 0x59a3387f, 0x508f191a, 0x6b66672b,
        0x480728a9, 0x834962b0, 0xf573e738, 0x0425c00a, 0xa5e45f58, 0x1f757189,
        0x550fff27, 0xae5bc34d, 0x31997226, 0xeb5b9b84, 0x0890ef5c, 0x7ef23def,
        0x747562fa, 0xa8803d3e, 0x7df2ab67, 0x67f17209, 0x5eef7401, 0x82a1b02e,
        0x50f95123, 0x638e1509, 0x61028424, 0x0fc1187a, 0x4c700b4f, 0xc0f3db9d,
        0xbe1b68d8, 0x8e2d8590, 0xab4c6ae8, 0x42e213ba, 0xb5678a32, 0x27e97dd8,
        0xf0a314ad, 0xa85bf73c, 0xa245ffdc, 0xe19ec500, 0x564c69cf, 0x8996c90f,
        0xa78fe8f8, 0x3a810a8b, 0x1e5ada2f, 0x3e988e1d, 0x8fab693f, 0x2c8922cd,
        0xcba2df5f, 0x53b33632, 0xf45d58f3, 0xab715265, 0x6499f43e, 0xbb765ce9,
        0xada7982c, 0x4790f356, 0x1a6d08dc, 0x2566132b, 0x6166db99, 0xd3bc8ac0,
        0x3acc5cee, 0x6ab30d5b, 0x59bfd34a, 0xcebba24c, 0x6ac82dc3, 0x1d107036,
        0xce1cbde9, 0x098baf5c, 0x408d311c, 0x4ebb98af, 0xf4e1a13d, 0x978c5835,
        0xb61f803c, 0x4598d30f, 0x725c52e9, 0xc30cd5cb, 0xb6decd32, 0xafe1a1d5,
        0x86015146, 0x83c90403, 0xc9ecf92a, 0x8555c5d9, 0xc91b340e, 0x98a069e9,
        0x2031e58e, 0xcd0ab4a0, 0xe4961cb2, 0x5a79699d, 0xa015eab3, 0x55b8d169,
        0x76314f06, 0x78b69316, 0xe0da56b9, 0xd60d0abd, 0x84b92e5f, 0x7a2563ac,
        0xd93cab41, 0xb76d0341, 0x9367a24d, 0x44fe6fce, 0x3cd871af, 0x5351efce,
        0x48a1ce80, 0x7e067ea2, 0xa8d5250b, 0x7db8fd26, 0x9ba90a10, 0xe1f198ec,
        0x397a9a41, 0xff6ba410, 0xd4bc401d, 0x3a3c31e0, 0x429c051a, 0xa370edbb,
        0x52d10e7b, 0x607029f8, 0xb550c9bf, 0x6dea67ca, 0x5db3b8d1, 0x30b59bfd,
        0x3bb0583b, 0xf5303c81, 0x6e5cb4ea, 0x36f544e6, 0xfe32aec6, 0x9829798d,
        0x97829b7d, 0x945aa46b, 0x3e84d7c2, 0x41e209ee, 0x66eef11a, 0xa5f70e88,
        0x0ee178d4, 0xefbfcca3, 0x4ff6e25e, 0x2e2fd5d5, 0xbf8a7b6d, 0x229edb6e,
        0xfd7b449f, 0xe988aeb5, 0x11d32ef0, 0x29af2d1d, 0x0369f1c4, 0x2f385862,
        0xc733c25a, 0xa89ce8c8, 0x89d096c8, 0x13589fb2, 0xd5136479, 0xfb02e7e5,
        0x00957e33, 0xe95d3cbc, 0xd43b8788, 0x0622feac, 0x9e35d1bf, 0xfee58d2f,
        0x24a79f39, 0xbcbf0974, 0xb21ca373, 0xac72d49d, 0xeb7b53ac, 0xdf5dc64c,
        0x4187aadc, 0x2a7b048c, 0x9561b0eb, 0x62ff0e16, 0xf9c3a8d3, 0xa2805a08,
        0xeeab4a40, 0xe9f99804, 0xcc96b627, 0xbe8ebfa2, 0x00b0cf51, 0xa0e539c9,
        0x63cf0f86, 0x9ff0b4ac, 0x7bef839e, 0x855828b5, 0xcbab5650, 0x161b4f2c,
        0x101f1912, 0x380210ff, 0xcf95ef98, 0x1d44ec00, 0x0caa91e5, 0x5065ce40,
        0xa6740c01, 0x857827ba, 0xbec7777f, 0x9e36af27, 0x350e3514, 0x0b1a0049,
        0x90deec27, 0x33f21080, 0x4554773e, 0xac8d80f7, 0x1cae5deb, 0x54b2dabd,
        0x50274756, 0x1dedad1b, 0xbfb394f1, 0x9163d1c9, 0x51959650, 0x08cc5482,
        0xbbf8acf3, 0x4b04b045, 0x19e0132a, 0xf16e43c5, 0x5426ddf7, 0xc57c720a,
        0xe3dc5f3e, 0xf0db090b, 0x1ccb87d1, 0x7ae1ff86, 0x1e8be44d, 0x4a2beb24,
        0xb5f6e3f1, 0x8387a72e, 0xfc524dd9, 0x73626ee9, 0x4304b334, 0x736128a1,
        0x2f8c6f88, 0x82bda223, 0xca7b3584, 0xaf53e35c, 0x307d8924, 0x9fe6937a,
        0xf907b837, 0xd8f3ebd5, 0x51e733b4, 0x5e7dc07f, 0x7240b5d6, 0x6126b6ab,
        0x5fe9a4d0, 0xbbf9557f, 0x79b25f02, 0x1ff35752, 0xe752cd2f, 0xabb1c190,
        0xd4e88f5e, 0xecec6fe1, 0x5b7df905, 0xff961c2c, 0x4b3c708d, 0x92e6ed6c,
        0xa6ad5e95, 0xa8761bf3, 0x35f9fc64, 0x741c4ad3, 0x138192f8, 0x6be9860c,
        0x21938126, 0x6502a4b1, 0x775d81e0, 0x1cfbe017, 0x9e42dcb4, 0xd0193ba2,
        0x4b19781e, 0x4df166ba, 0xc8259d2f, 0xfc51ff65, 0xb0e58de9, 0xefb3fcba,
        0x5dd7ad33, 0x59888118, 0x2d690171, 0xdd6630c5, 0xb604bf28, 0xc414f825,
        0x517a2a5f, 0xa666ef86, 0xc34e77ef, 0xed2ad4be, 0xa77dcb59, 0xc9eeb721,
        0xd97f5755, 0x1f758b56, 0x72e7a66f, 0xc74c9266, 0x1d336439, 0x7886b129,
        0x68dafc9c, 0x9a0ddd40, 0x9c1a49f2, 0x0902039f, 0xe8b40456, 0xff27b567,
        0xcf6b219e, 0x75a8ee60, 0xdbd102db, 0x0c0f582d, 0xf860d2e2, 0xc09da51b,
        0x4c8ce5e0, 0x7009fa03, 0xa4f9f7dc, 0x1540115a, 0xd5e0472e, 0x2caaad9f,
        0xe748384e, 0xdabd507e, 0x51f277c0, 0x4d173edf, 0x7b561faf, 0xeeee1860,
        0x57753f29, 0x74afc35c, 0xbea58b7f, 0x5c8195d8, 0x28451162, 0x1c1b6784,
        0xfc86f74d, 0xaf8cdade, 0x323028ce, 0x7fc7645e, 0x38aca5a2, 0xc60673b4,
        0xc01265fc, 0x8c1ee60b, 0x6f215847, 0xaa208b2a, 0xc16adb0c, 0xa0fb6ef4,
        0xb517e0ef, 0x0918467a, 0xfbb69b3b, 0x80f48e30, 0x50c4b4f1, 0x730ac951,
        0x22b78fda, 0x41490ac4, 0x9cf8ea06, 0xadcd53ad, 0x00bc37ea, 0xd7ba590e,
        0x5c9ad970, 0xce1cf05e, 0xaa96780c, 0x5d53466b, 0x5b33b273, 0x214d59f3,
        0x3c4e3f1e, 0x0df95204, 0xedbefdae, 0x6661c3af, 0xd873f0a5, 0x22a9dcc9,
        0x85a9e04d, 0x803288cd, 0x8a1aee40, 0x3f4c0ad5, 0x36acb198, 0x17f89917,
        0xcd3db36a, 0xc3cfb095, 0x9b5b89fe, 0x13e1d254, 0x19d512af, 0xd099cd48,
        0xbf14a84f, 0x432bcc5f, 0x8676a966, 0x30c4621a, 0x5ebbae1d, 0x26f2ac2b,
        0x9ba5c64b, 0x5144bcc0, 0x0f7957f6, 0xde01e290, 0x091301e7, 0x86a66d6d,
        0x13ac472b, 0x4a44c5da, 0x0dd4c0e2, 0xe1711ed3, 0x9b9caf1b, 0xe1397d2d,
        0x9ad3bb8f, 0xacd34c97, 0x5151994d, 0x69494c82, 0x9f67b783, 0x3ac8b2df,
        0x7b23dcee, 0xe017610f, 0xb59ca4e4, 0x11a4dc01, 0xaf3134f4, 0x6f01cc73,
        0xa4ddc6ab, 0xf76968ba, 0xc975d3fa, 0x86868171, 0xdabc088b, 0x99278ad4,
        0xb127fe6f, 0x2de67f24, 0x1a9b8af5, 0x078afdec, 0x107d84c0, 0x441d2110,
        0xd1ea853d, 0x98724c0d, 0x6f1687d7, 0x9f9bf6e3, 0xd5ef7f65, 0x5ee4337f,
        0x8730ca29, 0xa8a759d9, 0xd289eb1d, 0x115202be, 0xab2f8842, 0x54ee518f,
        0x1ef930f7, 0xeac0f6c2, 0x76006409, 0xf028219f, 0x7200515d, 0xcbb81e1e,
        0x9d108e6d, 0x5294bdc9, 0x20816ee2, 0xaf7aa064, 0xa2987bbe, 0xcd790986,
        0x14cf9042, 0x2598194b, 0x123f39f1, 0xbfed779c, 0xe8a53742, 0xd602f5c6,
        0xcb958370, 0x5282763c, 0x8269c1b6, 0x99f8a66b, 0xf0ed7f94, 0x5ebb751f,
        0x0b01dd55, 0xe1f13dab, 0x3679882e, 0xdfae325e, 0xd9358fb7, 0x13353a3e,
        0x6b8a6d41, 0x91729e0a, 0xaf012aea, 0xee9659ff, 0xe0e4aeb8, 0x7482e507,
        0xf80f6999, 0xb7b66846, 0xf5521708, 0xfe53a3c4, 0x7d7ee9aa, 0xe4964933,
        0xd2d71e09, 0x710551e0, 0xec23ac72, 0xd62febe2, 0x6d915b0f, 0x037f951a,
        0x5c3086d6, 0x1845fd4d, 0x03f478b0, 0xfca440aa, 0x29609e65, 0xb67fa083,
        0xf63ee9e3, 0xbc77e52f, 0xb913aab3, 0x673485ed, 0xdf1422fc, 0xa5c0bc8d,
        0xf2fb9b2e, 0x998ca1f3, 0xa8c921b3, 0xae09f12d, 0xb0800834, 0xb2568e98,
        0x49ab4a61, 0x714027cf, 0xaa91d6ce, 0x4c920cb0, 0xe478956b, 0x72722b7f,
        0x0df54454, 0x762d6e30, 0x65565fd8, 0x37c38bdc, 0x2ddd99b4, 0x2b1ae390,
        0x7dae40d8, 0x35e81111, 0xf0399a4b, 0xa2798b3a, 0x35d9d4d0, 0xcc2d2ac2,
        0x0c9a195e, 0x07d80092, 0xd0126e01, 0xe4acf0ac, 0x15cacf50, 0x7f0c5f0b,
        0x85c2837d, 0xb21d26bb, 0xd2684edf, 0xfa744b39, 0xa46c53d4, 0x1c02201c,
        0x55e261e7, 0x4fd34660, 0x076da6ea, 0xef612ead, 0xc5f79660, 0xbfb5690c,
        0x72658b3a, 0xc857008a, 0x49b0657d, 0x7ea7bd57, 0x9320c40e, 0x8ada47f0,
        0x1ba306e5, 0x5da197dd, 0x9c6534bb, 0x9aec28cb, 0x58f9998c, 0x5bc45383,
        0xe1923b72, 0xa8aa240b, 0x47ec3dc2, 0x2dce87f6, 0x4614dcde, 0x701a9784,
        0xad899a76, 0x56d2cd14, 0x6e10c39d, 0x78559b6b, 0x07559ab3, 0x8756ccca,
        0x12dbd18a, 0xac13c0fd, 0x58e5f4d0, 0x97af1b6f, 0x180832fa, 0x958987e7,
        0xcc52faf9, 0x67a6a10e, 0x3ec34f68, 0xe7ca38bd, 0x36c5b543, 0x6ba5b068,
        0x22a6a2a8, 0x3805cd95, 0x476eb75e, 0xa5558920, 0x58d69c01, 0xe0d47b71,
        0xe39df087, 0x4f70175a, 0x3f61edb6, 0x58cfdf43, 0x2d7ded78, 0xb3a28961,
        0xfe4fa6d4, 0xcd575912, 0x2b051148, 0xeefd8a3d, 0x1ff626bd, 0x7f2ea29e,
        0x02ebeb02, 0x8ff120c7, 0xeb8a0886, 0x888a70db, 0x07afd7e7, 0x096e3612,
        0x7041d93f, 0xaf54e6d9, 0xccf02c72, 0x93b0a57e, 0x3bbaa430, 0xac9d5e65,
        0x60a52d2a, 0xcfeb21da, 0x4b4c09b8, 0xc4778ce1, 0x6d2562ca, 0xfdd036a2,
        0xeb5d5be5, 0x641a410d, 0x2643d62f, 0xcc1e6393, 0x788d9a0d, 0x9dc00019,
        0x2f3fad55, 0x72434579, 0x80728da9, 0xc0e27225, 0x10b9e08d, 0x21510a4f,
        0x58ddc02a, 0xf63afc07, 0xeeebcd6f, 0x2a92134f, 0xec93e144, 0x3b2badee,
        0x11e3b2e6, 0x3aa7bd38, 0x825a13a2, 0xb22ed497, 0x2c54ae14, 0xad6e7ab2,
        0x2402884a, 0x00b18bc1, 0x95336265, 0x855ce8e2, 0xdf80368e, 0x17c717ad,
        0x9e47a422, 0x503b54d4, 0xd546cdff, 0x808615d1, 0xb1ac71c1, 0x21f4d89c,
        0x2208a864, 0x12ec58e5, 0x18f544cd, 0x4e6f9bdd, 0x6e074004, 0xad819611,
        0x5fb03727, 0x695822f9, 0x93060d05, 0x8042bc5c, 0x41e4e634, 0x912f8351,
        0x91ec8711, 0xc5d46079, 0xd45e2895, 0xf4b627e9, 0xe60f808c, 0x1acac3f0,
        0x40c08cdc, 0x7f8bf08d, 0x9e3ebc1f, 0xea8e23f2, 0xd4db2275, 0xdc728d9d,
        0x5b057946, 0xf292b9ac, 0xf1453fc5, 0x6611b969, 0x6ef631a8, 0x529cc52f,
        0x77a3d35e, 0x0f5a3e27, 0x0f06718b, 0x0f3fb09b, 0xa49e3ed1, 0x54745bc4,
        0x4f900dc7, 0xad355598, 0x05013c59, 0xd878d470, 0xae3f4011, 0xb7ac99d2,
        0xcfc9604a, 0x8e07171c, 0x96e6fdea, 0x9608f12b, 0x721c9bb7, 0x25247473,
        0xef381af1, 0xe92510d0, 0xe3dbc0e1, 0x06d7727e, 0xd7f3d7d0, 0x8cf8a5b4,
        0x381a69bc, 0xc338d9fd, 0xef26477b, 0x563b385d, 0xb27d2d04, 0x1e566c84,
        0x486d6c7d, 0xc04fdfc9, 0x8b16633e, 0x31dec252, 0x5306e91f, 0xdce25d71,
        0xb70fb1e1, 0xd7e87d88, 0xd17ae17f, 0x155ddbef, 0x6b65b332, 0x35051a0d,
        0xc0e80ad8, 0x493707f3,
    }};

static uint32_t kSpxEnabled = 0;

static void enable_spx_verify(void) { kSpxEnabled = 0; }

static void disable_spx_verify(void) { kSpxEnabled = kSigverifySpxDisabledOtp; }

uint32_t sigverify_spx_verify_enabled(lifecycle_state_t lc_state) {
  if (kSpxEnabled != kSigverifySpxDisabledOtp) {
    LOG_INFO("spx_verify is enabled");
  } else {
    LOG_INFO("spx_verify is disabled");
  }
  return kSpxEnabled;
}

static rom_error_t spx_success_to_ok_test_impl(uint32_t v, bool eq) {
  uint32_t res = sigverify_spx_success_to_ok(v);
  LOG_INFO("0x%08x -> 0x%08x", v, res);
  if ((res == kErrorOk) ^ eq) {
    LOG_ERROR("Wrong result 0x%08x for 0x%08x", res, v);
    return kErrorUnknown;
  }
  return kErrorOk;
}

static rom_error_t spx_success_to_ok_test(void) {
  bool failed = false;
  failed |=
      spx_success_to_ok_test_impl(kSigverifySpxDisabledOtp, true) != kErrorOk;
  failed |= spx_success_to_ok_test_impl(kSigverifySpxSuccess, true) != kErrorOk;
  failed |= spx_success_to_ok_test_impl(UINT32_MAX, false) != kErrorOk;
  failed |= spx_success_to_ok_test_impl(0, false) != kErrorOk;
  failed |= spx_success_to_ok_test_impl(kErrorOk, false) != kErrorOk;
  if (failed) {
    return kErrorUnknown;
  }
  return kErrorOk;
}

static rom_error_t spx_verify_impl_test(void) {
  sigverify_spx_root_t expected_root;
  sigverify_spx_root_t actual_root;
  spx_public_key_root(kPubKey.data, expected_root.data);
  rom_error_t error =
      spx_verify(kSignature.data, NULL, 0, NULL, 0, (const uint8_t *)kMessage,
                 kMessageLen, kPubKey.data, actual_root.data);
  if (memcmp(&expected_root, &actual_root, sizeof(sigverify_spx_root_t)) != 0) {
    return kErrorUnknown;
  }
  return error;
}

static rom_error_t spx_verify_disabled_bad_signature_test(void) {
  disable_spx_verify();

  uint32_t flash_exec = 0;
  uint32_t good_word = kSignature.data[0];
  kSignature.data[0] = 0;
  rom_error_t error =
      sigverify_spx_verify(&kSignature, &kPubKey, kLcStateProd, NULL, 0, NULL,
                           0, &kMessage, kMessageLen, &flash_exec);
  kSignature.data[0] = good_word;

  if (flash_exec != kSigverifySpxSuccess) {
    LOG_ERROR("flash_exec must be 0x%08x, not 0x%08x", kSigverifySpxSuccess,
              flash_exec);
    return kErrorUnknown;
  }
  return error;
}

static rom_error_t spx_verify_disabled_good_signature_test(void) {
  disable_spx_verify();

  uint32_t flash_exec = 0;
  rom_error_t error =
      sigverify_spx_verify(&kSignature, &kPubKey, kLcStateProd, NULL, 0, NULL,
                           0, &kMessage, kMessageLen, &flash_exec);

  if (flash_exec != kSigverifySpxSuccess) {
    LOG_ERROR("flash_exec must be 0x%08x, not 0x%08x", kSigverifySpxSuccess,
              flash_exec);
    return kErrorUnknown;
  }
  return error;
}

static rom_error_t spx_verify_enabled_bad_signature_test(void) {
  enable_spx_verify();

  uint32_t flash_exec = 0;
  uint32_t good_word = kSignature.data[0];
  kSignature.data[0] = 0;
  rom_error_t error =
      sigverify_spx_verify(&kSignature, &kPubKey, kLcStateProd, NULL, 0, NULL,
                           0, &kMessage, kMessageLen, &flash_exec);
  kSignature.data[0] = good_word;

  if (error == kErrorOk) {
    LOG_ERROR("error should not be kErrorOk");
    return kErrorUnknown;
  }
  if (flash_exec != UINT32_MAX) {
    LOG_ERROR("flash_exec must be UINT32_MAX");
    return kErrorUnknown;
  }

  return kErrorOk;
}

static rom_error_t spx_verify_enabled_good_signature_test(void) {
  enable_spx_verify();

  uint32_t flash_exec = 0;
  rom_error_t error =
      sigverify_spx_verify(&kSignature, &kPubKey, kLcStateProd, NULL, 0, NULL,
                           0, &kMessage, kMessageLen, &flash_exec);

  if (flash_exec != kSigverifySpxSuccess) {
    LOG_ERROR("flash_exec must be 0x%08x, not 0x%08x", kSigverifySpxSuccess,
              flash_exec);
    return kErrorUnknown;
  }
  return error;
}

OTTF_DEFINE_TEST_CONFIG();

bool test_main(void) {
  (void)kPrivKey;  // Use `kPrivKey` to avoid unused variable warning.

  status_t error = OK_STATUS();

  EXECUTE_TEST(error, spx_success_to_ok_test);
  EXECUTE_TEST(error, spx_verify_impl_test);
  EXECUTE_TEST(error, spx_verify_disabled_bad_signature_test);
  EXECUTE_TEST(error, spx_verify_disabled_good_signature_test);
  EXECUTE_TEST(error, spx_verify_enabled_bad_signature_test);
  EXECUTE_TEST(error, spx_verify_enabled_good_signature_test);

  return status_ok(error);
}
