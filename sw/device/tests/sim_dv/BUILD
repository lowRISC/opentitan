# Copyright lowRISC contributors.
# Licensed under the Apache License, Version 2.0, see LICENSE for details.
# SPDX-License-Identifier: Apache-2.0

load("//rules:opentitan.bzl", "OPENTITAN_CPU")
load("//rules:opentitan_test.bzl", "opentitan_functest")

opentitan_functest(
    name = "uart_tx_rx_test",
    srcs = ["uart_tx_rx_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/ip/lc_ctrl/data:lc_ctrl_regs",
        "//hw/top_darjeeling/ip/clkmgr/data/autogen:clkmgr_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:clkmgr",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:uart",
        "//sw/top_darjeeling/sw/test/utils:clkmgr_testutils",
    ],
)

opentitan_functest(
    name = "i2c_host_tx_rx_test",
    srcs = ["i2c_host_tx_rx_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/ip/lc_ctrl/data:lc_ctrl_regs",
        "//hw/top_darjeeling/ip/clkmgr/data/autogen:clkmgr_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:i2c",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:i2c_testutils",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rand_testutils",
    ],
)

opentitan_functest(
    name = "i2c_device_tx_rx_test",
    srcs = ["i2c_device_tx_rx_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/ip/lc_ctrl/data:lc_ctrl_regs",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:i2c",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:i2c_testutils",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rand_testutils",
    ],
)

opentitan_functest(
    name = "flash_ctrl_lc_rw_en_test",
    srcs = ["flash_ctrl_lc_rw_en_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:macros",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:keymgr",
        "//sw/top_darjeeling/sw/dif:kmac",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
    ],
)

opentitan_functest(
    name = "flash_rma_unlocked_test",
    srcs = ["flash_rma_unlocked_test.c"],
    # This test doesn't use the OTTF.
    targets = ["dv"],
    # This test is designed to run and complete entirely in the ROM boot stage.
    # Setting the `test_in_rom` flag makes the `opentitan_functest` rule aware
    # of this, and instructs it to load the test image into ROM.
    test_in_rom = True,
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:status",
        "//sw/device/lib/testing/test_rom:linker_script",
        "//sw/device/lib/testing/test_rom:test_rom_lib",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
        "//sw/top_darjeeling/sw/dif:uart",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
    ],
)

opentitan_functest(
    name = "flash_init_test",
    srcs = ["flash_init_test.c"],
    # This test doesn't use the OTTF.
    targets = ["dv"],
    # This test is designed to run and complete entirely in the ROM boot stage.
    # Setting the `test_in_rom` flag makes the `opentitan_functest` rule aware
    # of this, and instructs it to load the test image into ROM (rather than
    # loading the default test ROM, or any other ROM that may be specified).
    test_in_rom = True,
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:status",
        "//sw/device/lib/testing/test_rom:linker_script",
        "//sw/device/lib/testing/test_rom:test_rom_lib",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:uart",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
    ],
)

opentitan_functest(
    name = "gpio_test",
    srcs = ["gpio_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:gpio",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "lc_ctrl_scrap_test",
    srcs = ["lc_ctrl_scrap_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:bitfield",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/test/utils:lc_ctrl_testutils",
    ],
)

opentitan_functest(
    name = "otp_ctrl_vendor_test_csr_access_test",
    srcs = ["otp_ctrl_vendor_test_csr_access_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:bitfield",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
    ],
)

cc_library(
    name = "lc_ctrl_transition_impl",
    srcs = ["lc_ctrl_transition_impl.c"],
    hdrs = ["lc_ctrl_transition_impl.h"],
    target_compatible_with = [OPENTITAN_CPU],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/lib/sw/device/base:bitfield",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/test/utils:lc_ctrl_testutils",
    ],
)

opentitan_functest(
    name = "lc_ctrl_transition_test",
    srcs = ["lc_ctrl_transition_test.c"],
    targets = ["dv"],
    deps = [
        ":lc_ctrl_transition_impl",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/top_darjeeling/sw/device/runtime:print",
    ],
)

opentitan_functest(
    name = "lc_ctrl_volatile_raw_unlock_test",
    srcs = ["lc_ctrl_volatile_raw_unlock_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:bitfield",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/test/utils:lc_ctrl_testutils",
    ],
)

opentitan_functest(
    name = "lc_walkthrough_test",
    srcs = ["lc_walkthrough_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/lib/testing/test_framework:ottf_test_config",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:lc_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:otp_ctrl_testutils",
    ],
)

opentitan_functest(
    name = "lc_walkthrough_testunlocks_test",
    srcs = ["lc_walkthrough_testunlocks_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:lc_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:otp_ctrl_testutils",
    ],
)

opentitan_functest(
    name = "all_escalation_resets_test",
    srcs = ["all_escalation_resets_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:aes",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/dif:aon_timer",
        "//sw/top_darjeeling/sw/dif:clkmgr",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:kmac",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rom_ctrl",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:rv_core_ibex",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:sram_ctrl",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:ret_sram_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "data_integrity_escalation_reset_test",
    srcs = ["data_integrity_escalation_reset_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/runtime:ibex",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/dif:aon_timer",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:rv_core_ibex",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:sram_ctrl",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "clkmgr_external_clk_src_for_lc_test",
    srcs = ["clkmgr_external_clk_src_for_lc_test.c"],
    targets = ["dv"],
    deps = [
        ":lc_ctrl_transition_impl",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/top_darjeeling/sw/device/runtime:print",
    ],
)

opentitan_functest(
    name = "pwrmgr_main_power_glitch_test",
    srcs = ["pwrmgr_main_power_glitch_test.c"],
    targets = ["dv"],
    deps = [
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_sleep_power_glitch_test",
    srcs = ["pwrmgr_sleep_power_glitch_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_deep_sleep_power_glitch_test",
    srcs = ["pwrmgr_deep_sleep_power_glitch_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_random_sleep_all_reset_reqs_test",
    srcs = ["pwrmgr_random_sleep_all_reset_reqs_test.c"],
    tags = ["earlgrey"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/dif:aon_timer",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:rv_timer",
        "//sw/top_darjeeling/sw/dif:sysrst_ctrl",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_deep_sleep_all_reset_reqs_test",
    srcs = ["pwrmgr_deep_sleep_all_reset_reqs_test.c"],
    tags = ["earlgrey"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/dif:aon_timer",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:rv_timer",
        "//sw/top_darjeeling/sw/dif:sysrst_ctrl",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_normal_sleep_all_reset_reqs_test",
    srcs = ["pwrmgr_normal_sleep_all_reset_reqs_test.c"],
    tags = ["earlgrey"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/dif:aon_timer",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:rv_timer",
        "//sw/top_darjeeling/sw/dif:sysrst_ctrl",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_random_sleep_power_glitch_reset_test",
    srcs = ["pwrmgr_random_sleep_power_glitch_reset_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/dif:aon_timer",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:rv_timer",
        "//sw/top_darjeeling/sw/dif:sysrst_ctrl",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

# TODO(#500) Enable test once darjeeling build system does not try to build it.
# opentitan_functest(
#     name = "pwrmgr_usbdev_smoketest",
#     srcs = ["pwrmgr_usbdev_smoketest.c"],
#     tags = ["earlgrey"],
#     targets = ["dv"],
#     deps = [
#         "//sw/device/lib/testing/test_framework:ottf_main",
#         "//sw/lib/sw/device/base:mmio",
#         "//sw/lib/sw/device/runtime:hart",
#         "//sw/lib/sw/device/runtime:log",
#         "//sw/top_darjeeling/sw/device/runtime:print",
#         "//sw/top_darjeeling/sw/dif:pwrmgr",
#         "//sw/top_darjeeling/sw/dif:usbdev",
#         "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
#     ],
# )

# Removed, needs to be rewritten to use an alternate wake-up source
# opentitan_functest(
#     name = "rv_dm_access_after_wakeup",
#     srcs = ["rv_dm_access_after_wakeup.c"],
#     targets = ["dv"],
#     deps = [
#         "//hw/top_darjeeling/sw/autogen:top_darjeeling",
#         "//sw/device/lib/testing/test_framework:check",
#         "//sw/device/lib/testing/test_framework:ottf_main",
#         "//sw/lib/sw/device/base:abs_mmio",
#         "//sw/lib/sw/device/base:mmio",
#         "//sw/lib/sw/device/runtime:irq",
#         "//sw/lib/sw/device/runtime:log",
#         "//sw/top_darjeeling/sw/device/runtime:print",
#         "//sw/top_darjeeling/sw/dif:alert_handler",
#         "//sw/top_darjeeling/sw/dif:aon_timer",
#         "//sw/top_darjeeling/sw/dif:flash_ctrl",
#         "//sw/top_darjeeling/sw/dif:pinmux",
#         "//sw/top_darjeeling/sw/dif:pwrmgr",
#         "//sw/top_darjeeling/sw/dif:rstmgr",
#         "//sw/top_darjeeling/sw/dif:rv_plic",
#         "//sw/top_darjeeling/sw/dif:rv_timer",
#         "//sw/top_darjeeling/sw/dif:sysrst_ctrl",
#         "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
#         "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
#         "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
#         "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
#         "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
#     ],
# )

opentitan_functest(
    name = "rom_ctrl_integrity_check_test",
    srcs = ["rom_ctrl_integrity_check_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/lib/testing/test_framework:status",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:rom_ctrl",
    ],
)

opentitan_functest(
    name = "sleep_pin_mio_dio_val_test",
    srcs = ["sleep_pin_mio_dio_val_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rand_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "sleep_pin_wake_test",
    srcs = ["sleep_pin_wake_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rand_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "sleep_pin_retention_test",
    srcs = ["sleep_pin_retention_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:gpio",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rand_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "spi_tx_rx_test",
    srcs = ["spi_tx_rx_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/lib/testing/test_framework:status",
        "//sw/ip/base/dif:base",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:spi_device",
    ],
)

opentitan_functest(
    name = "spi_device_tpm_tx_rx_test",
    srcs = ["spi_device_tpm_tx_rx_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/lib/testing/test_framework:status",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:spi_device",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
    ],
)

opentitan_functest(
    name = "spi_host_tx_rx_test",
    srcs = ["spi_host_tx_rx_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:spi_host",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
        "//sw/top_darjeeling/sw/test/utils:rand_testutils",
    ],
)

opentitan_functest(
    name = "spi_passthrough_test",
    srcs = ["spi_passthrough_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:bitfield",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:spi_device",
        "//sw/top_darjeeling/sw/dif:spi_host",
        "//sw/top_darjeeling/sw/test/utils:pinmux_testutils",
        "//sw/top_darjeeling/sw/test/utils:spi_device_testutils",
        "//sw/top_darjeeling/sw/test/utils:spi_flash_testutils",
    ],
)

opentitan_functest(
    name = "rv_dm_ndm_reset_req",
    srcs = ["rv_dm_ndm_reset_req.c"],
    targets = ["dv"],
    deps = [
        "//hw/ip/adc_ctrl/data:adc_ctrl_regs",
        "//hw/ip/keymgr_dpe/data:keymgr_dpe_regs",
        "//hw/ip/otp_ctrl/data:otp_ctrl_regs",
        "//hw/ip/sysrst_ctrl/data:sysrst_ctrl_regs",
        "//hw/top_darjeeling/ip/pinmux/data/autogen:pinmux_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:adc_ctrl",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:keymgr_dpe",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:sysrst_ctrl",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

opentitan_functest(
    name = "rv_dm_ndm_reset_req_when_cpu_halted",
    srcs = ["rv_dm_ndm_reset_req_when_cpu_halted.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

opentitan_functest(
    name = "sram_ctrl_execution_main_test",
    srcs = ["sram_ctrl_execution_main_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/ip/otp_ctrl/data:otp_ctrl_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/lib/testing/test_framework:status",
        "//sw/lib/sw/device/base:bitfield",
        "//sw/lib/sw/device/base:macros",
        "//sw/lib/sw/device/base:multibits",
        "//sw/lib/sw/device/runtime:ibex",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:sram_ctrl",
        "//sw/top_darjeeling/sw/test/utils:lc_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:otp_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:sram_ctrl_testutils",
    ],
)

opentitan_functest(
    name = "sram_ctrl_scrambled_access_test",
    srcs = ["sram_ctrl_scrambled_access_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/ip/sram_ctrl/data:sram_ctrl_regs",
        "//hw/top_darjeeling/ip/rstmgr/data/autogen:rstmgr_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:macros",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/base:multibits",
        "//sw/lib/sw/device/base:stdasm",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:sram_ctrl_testutils",
    ],
)

cc_library(
    name = "pwrmgr_sleep_all_wake_ups_impl",
    srcs = ["pwrmgr_sleep_all_wake_ups_impl.c"],
    hdrs = ["pwrmgr_sleep_all_wake_ups_impl.h"],
    target_compatible_with = [OPENTITAN_CPU],
    deps = [
        "//hw/top_darjeeling/ip/pwrmgr/data/autogen:pwrmgr_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:ibex",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:adc_ctrl",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:pinmux",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:sensor_ctrl",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_normal_sleep_all_wake_ups",
    srcs = ["pwrmgr_normal_sleep_all_wake_ups.c"],
    tags = ["earlgrey"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/ip/pwrmgr/data/autogen:pwrmgr_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/tests/sim_dv:pwrmgr_sleep_all_wake_ups_impl",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_deep_sleep_all_wake_ups",
    srcs = ["pwrmgr_deep_sleep_all_wake_ups.c"],
    tags = ["earlgrey"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/ip/pwrmgr/data/autogen:pwrmgr_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/tests/sim_dv:pwrmgr_sleep_all_wake_ups_impl",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "pwrmgr_random_sleep_all_wake_ups",
    srcs = ["pwrmgr_random_sleep_all_wake_ups.c"],
    tags = ["earlgrey"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/ip/pwrmgr/data/autogen:pwrmgr_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/tests/sim_dv:pwrmgr_sleep_all_wake_ups_impl",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/dif:pwrmgr",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
        "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

# opentitan_functest(
#     name = "adc_ctrl_sleep_debug_cable_wakeup_test",
#     srcs = ["adc_ctrl_sleep_debug_cable_wakeup_test.c"],
#     targets = ["dv"],
#     deps = [
#         "//hw/top_darjeeling/sw/autogen:top_darjeeling",
#         "//sw/device/lib/testing/test_framework:check",
#         "//sw/device/lib/testing/test_framework:ottf_main",
#         "//sw/lib/sw/device/base:mmio",
#         "//sw/lib/sw/device/runtime:hart",
#         "//sw/lib/sw/device/runtime:irq",
#         "//sw/lib/sw/device/runtime:log",
#         "//sw/top_darjeeling/sw/device/runtime:print",
#         "//sw/top_darjeeling/sw/dif:adc_ctrl",
#         "//sw/top_darjeeling/sw/dif:pwrmgr",
#         "//sw/top_darjeeling/sw/dif:rstmgr",
#         "//sw/top_darjeeling/sw/dif:rv_plic",
#         "//sw/top_darjeeling/sw/test/utils:isr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
#     ],
# )

# opentitan_functest(
#     name = "pwrmgr_b2b_sleep_reset_test",
#     srcs = ["pwrmgr_b2b_sleep_reset_test.c"],
#     tags = ["earlgrey"],
#     targets = ["dv"],
#     deps = [
#         "//hw/ip/aon_timer/data:aon_timer_regs",
#         "//hw/top_darjeeling/sw/autogen:top_darjeeling",
#         "//sw/device/lib/testing/test_framework:ottf_main",
#         "//sw/lib/sw/device/base:abs_mmio",
#         "//sw/lib/sw/device/base:mmio",
#         "//sw/lib/sw/device/runtime:log",
#         "//sw/top_darjeeling/sw/device/runtime:print",
#         "//sw/top_darjeeling/sw/dif:flash_ctrl",
#         "//sw/top_darjeeling/sw/dif:pinmux",
#         "//sw/top_darjeeling/sw/dif:pwrmgr",
#         "//sw/top_darjeeling/sw/dif:rstmgr",
#         "//sw/top_darjeeling/sw/dif:sysrst_ctrl",
#         "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
#         "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
#         "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
#         "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
#     ],
# )

opentitan_functest(
    name = "sensor_ctrl_status_test",
    srcs = ["sensor_ctrl_status.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/ip/sensor_ctrl/data:sensor_ctrl_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:ibex",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:sensor_ctrl",
        "//sw/top_darjeeling/sw/test/utils:isr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

opentitan_functest(
    name = "alert_handler_escalation_test",
    srcs = ["alert_handler_escalation.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling:alert_handler_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:ibex",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/dif:clkmgr",
        "//sw/top_darjeeling/sw/dif:keymgr",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:rv_core_ibex",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
        "//sw/top_darjeeling/sw/test/utils:keymgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

opentitan_functest(
    name = "alert_handler_entropy_test",
    srcs = ["alert_handler_entropy_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling:alert_handler_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
    ],
)

opentitan_functest(
    name = "lc_ctrl_program_error",
    srcs = ["lc_ctrl_program_error.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/arch:device",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:ibex",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:alert_handler",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/dif:rv_core_ibex",
        "//sw/top_darjeeling/sw/dif:rv_plic",
        "//sw/top_darjeeling/sw/dif:sram_ctrl",
        "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:lc_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:nv_counter_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
        "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
    ],
)

# TODO(#500) Enable test once darjeeling build system does not try to build it.
# opentitan_functest(
#     name = "ast_usb_clk_calib",
#     srcs = ["ast_usb_clk_calib.c"],
#     tags = ["earlgrey"],
#     targets = ["dv"],
#     deps = [
#         "//hw/top_darjeeling/ip/ast/data:ast_regs",
#         "//hw/top_darjeeling/sw/autogen:top_darjeeling",
#         "//sw/device/lib/testing/test_framework:ottf_main",
#         "//sw/ip/base/dif:base",
#         "//sw/lib/sw/device/base:memory",
#         "//sw/lib/sw/device/base:mmio",
#         "//sw/lib/sw/device/runtime:log",
#         "//sw/top_darjeeling/sw/device/runtime:print",
#         "//sw/top_darjeeling/sw/dif:clkmgr",
#         "//sw/top_darjeeling/sw/dif:pinmux",
#         "//sw/top_darjeeling/sw/dif:usbdev",
#         "//sw/top_darjeeling/sw/test/utils:clkmgr_testutils",
#     ],
# )

opentitan_functest(
    name = "csrng_fuse_en_sw_app_read",
    srcs = ["csrng_fuse_en_sw_app_read.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/ip/base/dif:base",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:csrng",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:csrng_testutils",
        "//sw/top_darjeeling/sw/test/utils:otp_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

opentitan_functest(
    name = "inject_scramble_seed",
    srcs = ["inject_scramble_seed.c"],
    targets = ["dv"],
    deps = [
        "//hw/ip/otp_ctrl/data:otp_ctrl_regs",
        "//hw/top_darjeeling/ip/flash_ctrl/data/autogen:flash_ctrl_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:hart",
        "//sw/lib/sw/device/runtime:irq",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:flash_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:otp_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:rand_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

opentitan_functest(
    name = "exit_test_unlocked_bootstrap",
    srcs = ["exit_test_unlocked_bootstrap.c"],
    targets = ["dv"],
    deps = [
        "//hw/ip/otp_ctrl/data:otp_ctrl_regs",
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/lib/sw/device/base:abs_mmio",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:rstmgr",
    ],
)

opentitan_functest(
    name = "otp_ctrl_lc_signals_test",
    srcs = ["otp_ctrl_lc_signals_test.c"],
    targets = ["dv"],
    deps = [
        "//hw/top_darjeeling/sw/autogen:top_darjeeling",
        "//sw/device/lib/testing/test_framework:check",
        "//sw/device/lib/testing/test_framework:ottf_main",
        "//sw/device/lib/testing/test_framework:ottf_test_config",
        "//sw/device/silicon_creator/lib/drivers:retention_sram",
        "//sw/lib/sw/device/base:memory",
        "//sw/lib/sw/device/base:mmio",
        "//sw/lib/sw/device/runtime:log",
        "//sw/lib/sw/device/silicon_creator/base:chip",
        "//sw/top_darjeeling/sw/device/runtime:print",
        "//sw/top_darjeeling/sw/dif:flash_ctrl",
        "//sw/top_darjeeling/sw/dif:keymgr_dpe",
        "//sw/top_darjeeling/sw/dif:kmac",
        "//sw/top_darjeeling/sw/dif:lc_ctrl",
        "//sw/top_darjeeling/sw/dif:otp_ctrl",
        "//sw/top_darjeeling/sw/dif:rstmgr",
        "//sw/top_darjeeling/sw/test/utils:keymgr_dpe_testutils",
        "//sw/top_darjeeling/sw/test/utils:kmac_testutils",
        "//sw/top_darjeeling/sw/test/utils:lc_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:otp_ctrl_testutils",
        "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
    ],
)

# opentitan_functest(
#     name = "ast_clk_rst_inputs",
#     srcs = ["ast_clk_rst_inputs.c"],
#     targets = ["dv"],
#     deps = [
#         "//hw/top_darjeeling/ip/sensor_ctrl/data:sensor_ctrl_regs",
#         "//hw/top_darjeeling/sw/autogen:top_darjeeling",
#         "//sw/device/lib/testing/test_framework:ottf_main",
#         "//sw/lib/sw/device/base:memory",
#         "//sw/lib/sw/device/base:mmio",
#         "//sw/lib/sw/device/runtime:irq",
#         "//sw/lib/sw/device/runtime:log",
#         "//sw/top_darjeeling/sw/device/runtime:print",
#         "//sw/top_darjeeling/sw/dif:adc_ctrl",
#         "//sw/top_darjeeling/sw/dif:alert_handler",
#         "//sw/top_darjeeling/sw/dif:aon_timer",
#         "//sw/top_darjeeling/sw/dif:clkmgr",
#         "//sw/top_darjeeling/sw/dif:pwrmgr",
#         "//sw/top_darjeeling/sw/dif:rstmgr",
#         "//sw/top_darjeeling/sw/dif:rv_plic",
#         "//sw/top_darjeeling/sw/dif:sensor_ctrl",
#         "//sw/top_darjeeling/sw/test/utils:alert_handler_testutils",
#         "//sw/top_darjeeling/sw/test/utils:aon_timer_testutils",
#         "//sw/top_darjeeling/sw/test/utils:clkmgr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:isr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:pwrmgr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:rstmgr_testutils",
#         "//sw/top_darjeeling/sw/test/utils:rv_plic_testutils",
#     ],
# )
